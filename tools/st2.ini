[general]
PAGE_LIMIT=25
VER=828
;;;;;;;;;;;;;;;;filter;;;;;;;;;
[filter]
except = need_login,set_marco
need_login = login,_login02,_reg02,login01,_login,loginfail,consume,cus_set_pwd,cus_login,init,create_feedback
set_marco = login,login01,_login02,_reg02,_login,loginfail,consume,cus_set_pwd,cus_login,init,create_feedback
;require_email = login,_login02,_reg02,login01,_login,loginfail,consume,cus_set_pwd,cus_login,init,create_feedback,email01,email0101,pwd01,pwd0101,index,lite02,lite03,lite04
require_email = login,_login02,_reg02,login01,_login,loginfail,consume,cus_set_pwd,cus_login,init,create_feedback
;require_pwd = login,_login02,_reg02,login01,_login,loginfail,consume,cus_set_pwd,cus_login,init,create_feedback,pwd01,pwd0101,email01,email0101,index,lite02,lite03,lite04
require_pwd = login,_login02,_reg02,login01,_login,loginfail,consume,cus_set_pwd,cus_login,init,create_feedback
;adcount = create_feedback

[login]
program name=_login('index','loginfail')
[init]
img url prefix=http://119.6.97.198:8082
[email01]
nav0 sql=select 'S_EMAIL' as mail,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=email0101)
init act=A_POPUP(0)

pop0 layout=P06
pop0 sql=with cout as (select '' as cout),\
        img as (select photo from cat where fld='user_update' and code='S_UPDATE') \
        select img.photo as name from cout left outer join img on 1=1
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

list0 layout=L41
list0 sql=with usr as (select email  from usr where usr.nid='@@@NUID@@@'),\
                t1 as (select 'S_EMAIL1' as mail,'S_SUBMIT' as btn) \	
                  select mail,email,btn from t1 left outer join usr on 1=1
list0 txt field=1
list0 tag 1=EML,>1,<51
list0 re 1=^(?=\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$).{0,50}$
list0 btn field=2
list0 act btn=A_SUBMIT(scr=email0101)

[email0101]
post sql=select f_email_set_n('@@@NUID@@@','@@@email@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
                                and key='lite04010301.msg' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act submit=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
                                and key='lite04010301.msg1' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act submit=A_BACK;A_GET(scr=index);

pop2 layout=P01
pop2 sql=with rwd as (select name as reward from cat where fld='usr.reward' and code='S_BOUND_EMAIL'),\
                  usr as (select coin from usr where usr.nid='@@@NUID@@@') \
                 select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit,reward,coin from lang,rwd,usr \
                        where fld='st.msg' and key='lite04010301.msg2' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 hidden field=3,4
pop2 act submit=A_BACK;A_GET(scr=index);

[pwd01]
nav0 sql=select 'S_PWD' as s_pwd,'S_SUBMIT' as s_submit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=pwd0101)
init act=A_POPUP(0)
pop0 layout=P06
pop0 sql=with cout as (select '' as cout),\
        img as (select photo from cat where fld='user_update' and code='S_UPDATE') \
        select img.photo as name from cout left outer join img on 1=1
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

list0 layout=L35
list0 sql=select 'S_DESC_PWD' as spwd, '' as cur_pwd,'' as newpwd ,'' as new_pwd_cnfm,'S_SUBMIT' as btn_submit,\
                                 hpwd,'' as dis from usr where usr.nid='@@@NUID@@@'
list0 hidden field=5,6
list0 value dis='DIS,' if (hpwd eq '');\
                    '' if (1)
list0 txt field=1,2,3
list0 btn field=4
list0 tag 1=PWD,@@@dis@@@>0
list0 tag 2=PWD,>5,<13
list0 tag 3=PWD,>5,<13,=newpwd
list0 re 2=^[^\u4e00-\u9fa5]{6,12}$
list0 re 3=^[^\u4e00-\u9fa5]{6,12}$
list0 act 4=A_SUBMIT(scr=pwd0101)

[pwd0101]
post sql=select f_pwd_submit_n('@@@NUID@@@','@@@cur_pwd@@@','@@@newpwd@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
                                and lang.key='lite04010101.msg1' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
                                and lang.key='lite04010101.msg' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_BACK;A_GET(scr=index)

[index]
init region=@@@COUNTRY@@@
post sql=update usr set city='@@@cur_city@@@' where usr.nid='@@@NUID@@@'
nav0 sql=select 'S_ST' as s_st,lang.val from usr,lang where usr.nid='@@@NUID@@@' \
		and lang.fld='pty.city' and lang.key=usr.city and lang.locale='@@@LANG@@@';select f_init_chkin_n('@@@NUID@@@');
nav0 btn field=1
nav0 act 1=scr=lite0103
list0 layout=L33
list0 style=H3
list0 sql=select cus.photo as photo,cus.name as cname,cus.nid as id,cus.stat as stat,'' as fld from cus,usr where cus.area=usr.city and usr.nid='@@@NUID@@@' \
	and store_flag = false and  bigtbl_nid is null order by cus.seq,cus.name
list0 img field=0
list0 hidden field=2,3,4
list0 link photo=,/images/
list0 value fld='scr=lite0101&cid=@@@id@@@' if (stat eq 't');\
	'' if (1)
list0 act 0=@@@fld@@@

list1 layout=L25
list1 style=HS
list1 sql=select prom.npid,prom.ncid,prom.photo,prom.type,'' as action from f_adv_show_n('@@@NUID@@@','@@@IP@@@',0,3) as prom
list1 img field=2
list1 hidden field=0,1,3,4
list1 link photo=,/images/
list1 value action='A_GET(_adcount=@@@nid@@@&fld=ADVERT&scr=lite0102&prom_id=@@@npid@@@)' if (type eq 'ADVERT');\
	'_adcount=@@@nid@@@&fld=PROM&scr=lite0104&prom_id=@@@npid@@@' if (type eq 'PROM');\
	'_adcount=@@@nid@@@&fld=CHKIN&scr=lite0105&prom_id=@@@npid@@@' if (type eq 'CHKIN');\
	'_adcount=@@@nid@@@&fld=GIFT&scr=lite0106&prom_id=@@@npid@@@' if (type eq 'GIFT');\
	'_adcount=@@@nid@@@&fld=GIFT&scr=lite010104&act_id=@@@npid@@@' if (type eq 'TCMMN1');\
	'' if (1)
list1 act photo=@@@action@@@

bar0 sql=select 'I_BAR_LITE_ME' as st,'I_BAR_LITE_FAVORITE' as collect, 'I_BAR_LITE_POCKET' as bag,\
        'I_BAR_LITE_MORE' as more
bar0 height=49
bar0 btn field=0,1,2,3
bar0 val st=S_ST
bar0 val collect=S_CLLCT
bar0 val bag=S_BAG
bar0 val more=S_MORE
bar0 link st=,
bar0 link collect=,
bar0 link bag=,
bar0 link more=,
bar0 act 0=scr=index
bar0 act 1=scr=lite02
bar0 act 2=scr=lite03
bar0 act 3=scr=lite04

[lite0102]
init act=A_POPUP(0)
pop0 layout=P06

pop0 layout=P06
pop0 sql=with cout as (select '' as cout),\
	img as (select prom.photo_dtl from prom where prom.nid='@@@prom_id@@@') \
        select img.photo_dtl as name from cout left outer join img on 1=1
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

[lite0103]
nav0 sql=select 'S_SWITCH_CITY' as sw_ct
init style=G
list0 title=S_CURCITY
list0 layout=L06
list0 sql=select lang.val from usr,lang where usr.nid='@@@NUID@@@' \
		and lang.fld='pty.city' and lang.key=usr.city and lang.locale='@@@LANG@@@'
		
list1 title=S_MAJORCITY
list1 layout=L06
list1 sql=select lang.val,lang.key from lang,usr where usr.nid='@@@NUID@@@' \
	and usr.city !=lang.key and lang.fld='pty.city' and lang.locale='@@@LANG@@@' \
	order by lang.seq,lang.key 
list1 hidden field=1
list1 row act=A_HOME(0,scr=index&cur_city=@@@key@@@)

[lite0101]
init act =A_POPUP(0)
style=TAB
;nav0 sql =select name,'S_MAP' as s_map,x,y from cus where id=@@@cid@@@
;nav0 btn field=1
;nav0 tag 2=X
;nav0 tag 3=Y
;nav0 act 1=A_MAP(1)
nav0 sql =select name from cus where cus.nid='@@@cid@@@'

pop0 layout=P07
pop0 sql = select name,coin,'' as cancel from usr where usr.nid='@@@NUID@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=lite0101&sbo=@@@sbo@@@&cid=@@@cid@@@)
sbo0 act flr=

list0 load=act=load&scr=lite0101&_ns=list0&cid=@@@cid@@@&sbo=@@@sbo@@@
list0 title=S_PROM
list0 layout=L37
list0 sql = select prom.nid as id,prom.photo as pphoto,prom.name as name,prom.subject, \
		f_prom_stat_n(prom.nid,'@@@LANG@@@') as pay_coin \
		from prom,cus,cus2prom \
		where prom.nid=cus2prom.prom_nid and cus.nid=cus2prom.ncid and prom.type='PROM' and cus.pnid='@@@cid@@@' and \
		case when '@@@sbo@@@' != '' \
		then (cus.name   ilike '%@@@sbo@@@%' or \
		prom.name  ilike '%@@@sbo@@@%' or \
		cus.addr   ilike '%@@@sbo@@@%') \
	 	else true end \
		and prom.end_at >= current_timestamp and prom.stat in ('t','ENABLE') \
		order by prom.prior,prom.pay_coin,prom.name,prom.nid
list0 img field=1
list0 hidden field=0
list0 link pphoto=,/images/
list0 row act=scr=lite010101&prom_id=@@@id@@@

list1 load=act=load&scr=lite0101&_ns=list1&cid=@@@cid@@@&sbo=@@@sbo@@@
list1 title=S_CUS
list1 layout=L37
list1 sql =(select cus.nid as nid,cus.photo,cus.name,cus.addr, \
		(select lang.val from lang where lang.fld='st.kwrd' and lang.key='S_NO_SIGN' and lang.locale='@@@LANG@@@') as stat, \
		'S_NO_SIGN' as fld,'' as act,cus.seq,1 as pay_coin,0 as coin \
		from cus where cus.pnid='@@@cid@@@' and COALESCE(cus.sign,'t')='f' \
		and COALESCE(cus.stat,'f')='t' and (case when '@@@sbo@@@' !=  ''  \
		then (cus.name ilike '%@@@sbo@@@%' or cus.addr ilike '%@@@sbo@@@%' ) \ 
		else true end)) \
		union \
		(select prom.nid,prom.photo,prom.name,cus.addr,f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@'), \
		'' as fld,'' as act,prom.prior,prom.pay_coin ,\
		substring(f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@') from '\d+')::integer as coin \
		from prom,cus2prom,cus where prom.nid = cus2prom.prom_nid and cus2prom.ncid = cus.nid \
		and COALESCE(cus.sign,'t')='t' and COALESCE(cus.stat,'f')='t' and prom.type='CHKIN' and cus.pnid='@@@cid@@@' \
		and prom.end_at > current_timestamp and (case when '@@@sbo@@@' !=  ''  \
		then (prom.name ilike '%@@@sbo@@@%' or cus.addr ilike '%@@@sbo@@@%') else true end)) \
		order by coin desc nulls last,seq nulls last,name,nid
list1 img field=1
list1 link photo=,/images/
list1 hidden field=0,5,6,7,8,9
list1 value act='scr=lite010203&cus_id=@@@nid@@@' if (fld eq 'S_NO_SIGN');\
		'scr=lite010201&prom_id=@@@nid@@@' if (1)
list1 row act=@@@act@@@

list2 load=act=load&scr=lite0101&_ns=list2&cid=@@@cid@@@
list2 title=S_ACTIVITY
list2 layout=L37
list2 sql=select prom.nid as act_id,prom.photo as tphoto,prom.name as pname, \
		prom.subject,substr(f_task_stat_n('@@@NUID@@@',prom.nid),1,position('|'  \
		in f_task_stat_n('@@@NUID@@@',prom.nid))-1) as stat,prom.type,'' as action \
		from prom,cus,cus2prom \
		where cus.nid=cus2prom.ncid and cus2prom.prom_nid=prom.nid \
		and cus.pnid='@@@cid@@@' and prom.type in ('TCMMN','TCMMN1') \
		and prom.end_at >= current_timestamp and prom.stat in ('t','ENABLE') order by prom.prior,prom.end_at,prom.nid
list2 img field=1,5,6
list2 link tphoto=,/images/
list2 hidden field=0
list2 value action='scr=lite010301&act_id=@@@act_id@@@' if (type  eq 'TCMMN');\
		'scr=lite010104&act_id=@@@act_id@@@' if (1)
list2 row act=@@@action@@@

;Advert Promotion Details
[lite0104]
;nav0 sql = select name,'S_MAP' as s_map from prom where id='@@@prom_id@@@'
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
nav0 sql = select 'S_PROM_DETAILS'  as promdetails

pop0 layout=P06
pop0 sql=select (case when prom.photo_dtl is null then 'DEFAULT_L.png' else prom.photo_dtl end) as name from prom where nid='@@@prom_id@@@' 
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

pop1 layout=P05
pop1 sql=with prom as (select prom.name,prom.pay_coin from prom where prom.nid='@@@prom_id@@@') \
		select 'S_HINT' as hint,lang.val,'S_CANCEL' as cancel,'S_CONFIRM' as confirm,prom.name,prom.pay_coin \
		from lang,prom where lang.fld='st.msg' and lang.key='treasure32.msg' and lang.locale='@@@LANG@@@'
pop1 btn field=2,3
pop1 hidden field=4,5
pop1 act 2=A_CANCEL
pop1 act 3=scr=lite010401&prom_id=@@@prom_id@@@&act=set

list0 layout=L34
list0 sql =with prom as (select prom.name as pname,prom.descr,prom.nid,prom.lk,prom.cllct,prom.share,prom.photo_l \
		from prom where prom.nid='@@@prom_id@@@') \
		select prom.photo_l as pphoto,prom.pname,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'S_EXCHANGE' as btn0,prom.descr as descr,cus.addr as addr,\
		cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,prom.share as share,\
		f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
		f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\	
		f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,\
		'' as btn3act,'' as zoom,f_zoom_show_n('@@@prom_id@@@') as imgstat,'' as imgact \
		from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
		and cus.nid=cus2prom.ncid
list0 img field=0,7,8,9,18
list0 btn field=3
list0 hidden field=13,14,15,16,17,19,20
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 tag btn3=SHARE
list0 act tel=callto://@@@tel@@@
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			   	 'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite010402&prom_id=@@@prom_id@@@)' if (btn1rv eq '0');\
			   		'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
			   	 'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			   	 'I_SHARE_OFF' if (1)
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite010403&prom_id=@@@prom_id@@@)
list0 act btn0=A_POPUP(1)
list0 act btn3=scr=lite010404&prom_id=@@@prom_id@@@&actions=S_EXCHANGE
list0 value zoom='I_ZOOM' if (imgstat eq '1');\
			   	  '' if (1)
list0 link zoom=,   	  			   	  
list0 value imgact='A_POPUP(0)' if (imgstat eq '1');\
            '' if (1)             			   	  
list0 act pphoto=@@@imgact@@@

;Advert promotion get
[lite010401]
post sql=select p_pay_coin as pay_coin,p_coin as coin,p_rv as rv,p_pid as pid,p_pname as pname from f_prom_get_n('@@@NUID@@@','@@@prom_id@@@','@@@LANG@@@') as prom
init act=A_POPUP(@@@rv@@@)

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0104&prom_id=@@@prom_id@@@);A_HOMEGET(2)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as fail,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				 and lang.key='treasure33.msg1' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop2 layout=P01
pop2 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg3' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

pop3 layout=P01
pop3 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg2' and locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL

pop4 layout=P01
pop4 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg4' and locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

;Advert promotion like
[lite010402]
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite0104&prom_id=@@@prom_id@@@)

;Advert promotion Collect
[lite010403]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0104&prom_id=@@@prom_id@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0104&prom_id=@@@prom_id@@@);A_HOMEGET(1)

;Advert promotion Share
[lite010404]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite010405&prom_id=@@@prom_id@@@)
list0 layout=L36
list0 sql=with prom as (select prom.name as pname, cus.name as cname from prom,cus2prom,cus  where prom.nid=cus2prom.prom_nid \
	and cus2prom.ncid=cus.nid and prom.nid='@@@prom_id@@@'),\
      		   def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,lang.val from lang where lang.key='lite01010106.msg' and lang.locale='@@@LANG@@@'),\
      		   lang as (select lang.val as action from lang where lang.key='@@@actions@@@' and lang.locale='@@@LANG@@@') \
		  select lb,val as content,btn1,pname,cname,action from prom,def,lang
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite010405&prom_id=@@@prom_id@@@)

;Advert promotion put
[lite010405]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite0104&prom_id=@@@prom_id@@@)

;Advert Cus Detial
[lite0105]
;nav0 sql = select cus.name as cname,'S_MAP' as s_map from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
;nav0 sql = select cus.name as cname from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
nav0 sql = select 'S_CUS_DETAILS' as cusdetails

list0 layout=L34
list0 sql = select prom.photo_l as pphoto,prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'FLD' as btn0,\
                 prom.descr||(select val from lang where lang.key='S_CUS_DESC' and lang.locale='@@@LANG@@@') as descr,\
                 cus.addr as addr,cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,\
                 prom.share as share,'ACT' as act,f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@') as chk_stat,\
                 f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
                 f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\
                 f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,\
                 '' as btn3act,prom.chkin_type as chkintype,'' as fld \
                 from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
		 and cus.nid=cus2prom.ncid and prom.nid='@@@prom_id@@@'
list0 img field=0,7,8,9
list0 btn field=3
list0 hidden field=13,14,15,16,17,20,21
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 tag btn3=SHARE
list0 act tel=callto://@@@tel@@@
list0 value btn0='S_SIGNED_IN' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
				    'S_SIGN_IN'   if (1)
list0 value fld='DIS' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
            '' if (1)
list0 tag btn0=@@@fld@@@
list0 value act='A_POPUP(0)' if ('@@@chkintype@@@' eq 'QRCODE');\
				   'A_WALKIN(scr=lite010501&prom_id=@@@prom_id@@@)' if (1)			 
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			   	 'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite010502&prom_id=@@@prom_id@@@)' if (btn1rv eq '0');\
			   		'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
			   	 'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			   	 'I_SHARE_OFF' if (1)
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite010503&prom_id=@@@prom_id@@@)
list0 act btn0=@@@act@@@
list0 act btn3=scr=lite010504&prom_id=@@@prom_id@@@

pop0 layout=P05
pop0 sql=select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,\
    (select cus.name from cus where cus.nid='@@@cus_code@@@') as cname from lang \
		 where lang.fld='st.msg' and lang.key='lite0303.msg' and lang.locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite010501&prom_id=@@@prom_id@@@&sig=@@A_CODESCAN@@&act=set

;Advert Check in 

[lite0106]

init act=A_POPUP(0)
pop0 layout=P06

pop0 layout=P06
pop0 sql=with cout as (select '' as cout),\
	img as (select prom.photo_dtl from prom where nid='@@@prom_id@@@') \
	select prom.photo_dtl from cout left outer join img on 1=1
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL;scr=lite0107&prom_id=@@@prom_id@@@&act=set

[lite0107]
post sql=select p_rv as rv,p_name from f_gift_get_n('@@@NUID@@@','@@@prom_id@@@')
init act=A_POPUP(@@@rv@@@)

pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010601.msg0' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010601.msg1' \
                and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_CODEGEN(QRCODE,@@@NUID@@@@@@prom_id@@@)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010601.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

pop3 layout=P01
pop3 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010601.msg3' \
                and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL


[lite010501]
post sql = select p_rv as g_rv,p_pay_coin as g_pay_coin,p_coin as g_coin,p_cname as cname,p_pid as pid \
		   from f_chkin_n('@@@NUID@@@','@@@prom_id@@@','@@@sig@@@','@@@LANG@@@')
init act = A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msgfail' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msg' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0105&prom_id=@@@prom_id@@@);A_HOMEGET(3)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0105&prom_id=@@@prom_id@@@)

pop3 layout=P01
pop3 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg3' \
		and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_GET(scr=lite0105&prom_id=@@@prom_id@@@)

pop4 layout=P01
pop4 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish12.msgfail' \
		 and lang.locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

pop5 layout=P01
pop5 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg4' \
                 and lang.locale='@@@LANG@@@'
pop5 btn field=2
pop5 act 2=A_CANCEL
;Advert Cus like
[lite010502]
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite0105&prom_id=@@@prom_id@@@)

;Advert Cus Collect
[lite010503]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0105&prom_id=@@@prom_id@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0105&prom_id=@@@prom_id@@@);A_HOMEGET(1)

;Advert Cus Share
[lite010504]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite010505&prom_id=@@@prom_id@@@)
list0 layout=L36
list0 sql=with prom as (select pay_coin,name from prom where prom.nid='@@@prom_id@@@'),\
      def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,val from lang \ 
      where lang.key='lite01020106.msg' and lang.locale='@@@LANG@@@') \
		  select def.lb,def.val as content,def.btn1,prom.pay_coin,prom.name from prom,def
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite010505&prom_id=@@@prom_id@@@)

;Advert Cus put
[lite010505]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite0105&prom_id=@@@prom_id@@@)

;Advert Show 
[advshow]
init act=A_POPUP(0)
pop0 layout=P06
pop0 sql=select (case when prom.photo_dtl is null then 'DEFAULT_L.png' else prom.photo_dtl end) as name from prom where nid='@@@prom_id@@@'
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

;[lite_map]
;nav0 sql=select 'S_MAP' as s_map
;list0 layout=L21
;list0 sql = select name from img where type='MAP' and ext_id='@@@prom_id@@@' and size='L'
;list0 img field=0
;list0 link name=,/images/

[lite010101]
;init act=A_POPUP(0)
;nav0 sql = select name,'S_MAP' as s_map from prom where id='@@@prom_id@@@'
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
nav0 sql = select 'S_PROM_DETAILS'  as promdetails

pop0 layout=P06
pop0 sql=select (case when prom.photo_dtl is null then 'DEFAULT_L.png' else prom.photo_dtl end) as name from prom where nid='@@@prom_id@@@'
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

pop1 layout=P05
pop1 sql=with prom as (select prom.name,prom.pay_coin from prom where prom.nid='@@@prom_id@@@') \
		select 'S_HINT' as hint,lang.val,'S_CANCEL' as cancel,'S_CONFIRM' as confirm,prom.name,prom.pay_coin \
		from lang,prom where lang.fld='st.msg' and lang.key='treasure32.msg' and lang.locale='@@@LANG@@@'
pop1 btn field=2,3
pop1 hidden field=4,5
pop1 act 2=A_CANCEL
pop1 act 3=scr=lite01010103&prom_id=@@@prom_id@@@&act=set

list0 layout=L34
list0 sql =with prom as (select prom.name as pname,prom.descr,prom.nid,prom.lk,prom.cllct,prom.share,prom.photo_l \
		        from prom where prom.nid='@@@prom_id@@@') \
			select prom.photo_l as pphoto,prom.pname,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'S_EXCHANGE' as btn0,prom.descr as descr,cus.addr as addr,\
			cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,prom.share as share,\
			f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
			f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\	
			f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,\
			'' as btn3act,'' as zoom,f_zoom_show_n('@@@prom_id@@@') as imgstat,'' as imgact \
			from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid and cus.nid=cus2prom.ncid
list0 img field=0,7,8,9,18
list0 btn field=3
list0 hidden field=13,14,15,16,17,19,20
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 tag btn3=SHARE
list0 act tel=callto://@@@tel@@@
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			   	 'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite01010104&prom_id=@@@prom_id@@@)' if (btn1rv eq '0');\
			   		'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
			   	 'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			   	 'I_SHARE_OFF' if (1)
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite01010105&prom_id=@@@prom_id@@@)
;list0 act btn0=A_GET(scr=lite01010102&prom_id=@@@prom_id@@@)
list0 act btn0=A_POPUP(1)
list0 act btn3=scr=lite01010106&prom_id=@@@prom_id@@@&actions=S_EXCHANGE
list0 value zoom='I_ZOOM' if (imgstat eq '1');\
			   	  '' if (1)
list0 link zoom=,   	  			   	  
list0 value imgact='A_POPUP(0)' if (imgstat eq '1');\
            '' if (1)             			   	  
list0 act pphoto=@@@imgact@@@

[lite01010104]
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite010101&prom_id=@@@prom_id@@@)

[lite01010105]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010101&prom_id=@@@prom_id@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite010101&prom_id=@@@prom_id@@@);A_HOMEGET(1)

[lite01010106]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite01010107&prom_id=@@@prom_id@@@)
list0 layout=L36
list0 sql=with prom as (select prom.name as pname, cus.name as cname from prom,cus,cus2prom \
	where prom.nid=cus2prom.prom_nid \
	and cus2prom.ncid=cus.nid and prom.nid='@@@prom_id@@@'),\
      	def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,lang.val from lang where lang.key='lite01010106.msg' \
      	and lang.locale='@@@LANG@@@'),\
     	lang as (select lang.val as action from lang where lang.key='@@@actions@@@' and lang.locale='@@@LANG@@@') \
	select lb,val as content,btn1,pname,cname,action from prom,def,lang
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite01010107&prom_id=@@@prom_id@@@)

[lite01010107]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite010101&prom_id=@@@prom_id@@@)

[lite01010102]
init act=A_POPUP(0)
pop0 layout=P05
pop0 sql=with prom as (select prom.name,prom.pay_coin from prom where prom.nid='@@@prom_id@@@') \
		select 'S_HINT' as hint,val,'S_CANCEL' as cancel,'S_CONFIRM' as confirm,prom.name,prom.pay_coin \
		from lang,prom where lang.fld='st.msg' and lang.key='treasure32.msg' and lang.locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4,5
pop0 act 2=A_CANCEL
;A_GET(scr=lite010101&prom_id=@@@prom_id@@@);
pop0 act 3=A_SUBMIT(scr=lite01010103&prom_id=@@@prom_id@@@);

[lite01010103]
post sql=select p_pay_coin as pay_coin,p_coin as coin,p_rv as rv,p_pid as pid,p_pname as pname \
			from f_prom_get_n('@@@NUID@@@','@@@prom_id@@@','@@@LANG@@@') as prom
init act=A_POPUP(@@@rv@@@)

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010101&prom_id=@@@prom_id@@@);A_HOMEGET(2);A_PAGEGET(-1,scr=lite0101&cid=@@@pid@@@);

pop0 layout=P01
pop0 sql=select 'S_ERROR' as fail,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				 and lang.key='treasure33.msg1' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop2 layout=P01
pop2 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg3' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

pop3 layout=P01
pop3 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg2' and locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL

pop4 layout=P01
pop4 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg4' and locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

[lite010201]
;nav0 sql = select cus.name as cname,'S_MAP' as s_map from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
;nav0 sql = select cus.name as cname from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
nav0 sql = select 'S_CUS_DETAILS' as cusdetails

list0 layout=L34
list0 sql = select prom.photo_l as pphoto,prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'FLD' as btn0,\
		prom.descr||(select val from lang where lang.key='S_CUS_DESC' and lang.locale='@@@LANG@@@') as descr,\
		cus.addr as addr,cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,\
		prom.share as share,'ACT' as act,f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@') as chk_stat,\
		f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
		f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\
		f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,\
		'' as btn3act,prom.chkin_type as chkintype,'' as fld \
		from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
		and cus.nid=cus2prom.ncid and prom.nid='@@@prom_id@@@'
list0 img field=0,7,8,9
list0 btn field=3
list0 hidden field=13,14,15,16,17,20,21
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 tag btn3=SHARE
list0 act tel=callto://@@@tel@@@
list0 value btn0='S_SIGNED_IN' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
				         'S_SIGN_IN' if (1)
list0 value fld='DIS' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
                '' if (1)
list0 tag btn0=@@@fld@@@
list0 value act='A_POPUP(0)' if ('@@@chkintype@@@' eq 'QRCODE');\
			'A_WALKIN(scr=lite010202&prom_id=@@@prom_id@@@)' if (1)		 		 
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite01020104&prom_id=@@@prom_id@@@)' if (btn1rv eq '0');\
			'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
			'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			'I_SHARE_OFF' if (1)
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite01020105&prom_id=@@@prom_id@@@)
list0 act btn0=@@@act@@@
list0 act btn3=scr=lite01020106&prom_id=@@@prom_id@@@&actions=S_EXCHANGE

pop0 layout=P05
pop0 sql=select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,\
    (select cus.name from cus where cus.nid='@@@cus_code@@@') as cname from lang \
		 where lang.fld='st.msg' and lang.key='lite0303.msg' and locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite010202&prom_id=@@@prom_id@@@&sig=@@A_CODESCAN@@&act=set

[lite010202]
post sql = select p_rv as g_rv,p_pay_coin as g_pay_coin,p_coin as g_coin,p_cname as cname,p_pid as pid \
		from f_chkin_n('@@@NUID@@@','@@@prom_id@@@','@@@sig@@@','@@@LANG@@@')
init act = A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msgfail' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msg' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010201&prom_id=@@@prom_id@@@);A_PAGEGET(-1,scr=lite0101&cid=@@@pid@@@);A_HOMEGET(1);A_HOMEGET(3)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite010201&prom_id=@@@prom_id@@@)

pop3 layout=P01
pop3 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg3' \
		and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_GET(scr=lite010201&prom_id=@@@prom_id@@@)

pop4 layout=P01
pop4 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish12.msgfail' \
		 and lang.locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

pop5 layout=P01
pop5 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg4' \
                 and lang.locale='@@@LANG@@@'
pop5 btn field=2
pop5 act 2=A_CANCEL


[lite01020104]
;post sql=update prom set @@@fld@@@=@@@fld@@@+1 where id='@@@prom_id@@@'
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite010201&prom_id=@@@prom_id@@@)

[lite01020105]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
;init act=A_GET(scr=lite010201&cus_code=@@@cus_code@@@);A_HOMEGET(1)
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010201&prom_id=@@@prom_id@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite010201&prom_id=@@@prom_id@@@);A_HOMEGET(1)


[lite01020106]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite01020107&prom_id=@@@prom_id@@@)

list0 layout=L36
list0 sql=with prom as (select pay_coin,name from prom where nid='@@@prom_id@@@'),\
		def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,val from lang \ 
		where lang.key='lite01020106.msg' and locale='@@@LANG@@@') \
		select def.lb,def.val as content,def.btn1,prom.pay_coin,prom.name from prom,def
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite01020107&prom_id=@@@prom_id@@@)

[lite01020107]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite010201&prom_id=@@@prom_id@@@)
;init act=A_POPUP(@@@g_rv@@@)
;pop0 layout=P01
;pop0 sql=select 'S_HINT' as hint,'S_SUBMIT_FAIL' as fail,'S_OK' as ok
;pop0 btn field=2
;pop0 act 2=A_CANCEL

;pop1 layout=P01
;pop1 sql=select 'S_HINT' as hint,'S_SYNC_SUCC' as succ,'S_OK' as ok
;pop1 btn field=2
;pop1 act 2=A_CANCEL;A_BACK;A_GET(scr=lite010201&prom_id=@@@prom_id@@@)

;pop2 layout=P01
;pop2 sql=select 'S_HINT' as hint,'S_UNBIND_WEIBO' as bind,'S_OK' as ok
;pop2 btn field=2
;pop2 act 2=A_CANCEL;A_BACK

[lite010203]
;nav0 sql = select cus.name as cname,'S_MAP' as s_map from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
;nav0 sql = select cus.name as cname from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
nav0 sql = select 'S_CUS_DETAILS' as cusdetails

list0 layout=L34
list0 sql=select cus.photo_l as cphoto,cus.name,\
		(select lang.val from lang where lang.fld='st.kwrd' and lang.key='S_NO_SIGN' and lang.locale='@@@LANG@@@') as btn0,\
		'' as lbl,cus.info,cus.addr,cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3 \
		from cus where cus.nid='@@@cus_id@@@'  
list0 img field=0,7,8,9
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 btn field=2
list0 link cphoto=,/images/
list0 act tel=callto://@@@tel@@@		         
list0 tag btn0='DIS'
list0 value btn1='I_LIKE_OFF'
list0 value btn2='I_CLLCT_OFF'
list0 value btn3='I_SHARE_OFF' 

;Show Bag
;1.promotion tab:promotion get:[lite02]-->[lite0201]-->[lite020101]-->[lite0201]
;2.promotion tab:promotion like:[lite02]-->[lite0201]-->[lite020102]-->[lite0201]
;3.promotion tab:promotion cllct:[lite02]-->[lite0201]-->[lite020103]-->[lite0201]
;4.promotion tab:promotion share:[lite02]-->[lite0201]-->[lite020104]-->[lite020105]-->[lite0201]
;5.cus tab: Check in:[lite02]-->[lite0202]-->[lite020201]-->[lite0202]
;6.cus tab: Check in:[lite02]-->[lite0202]-->[lite020201]-->[lite0202]
[lite02]
init style=TAB
post sql=select f_cllct_del_n('@@@chkbox@@@','@@@chkbox.val@@@') as g_rv
nav0 sql =select 'S_CLLCT' as s_cllct, 'S_EDIT1' as s_edit
nav0 btn field=1
nav0 act 1=A_DEL(scr=lite02)

list0 load=act=load&scr=lite02&_ns=list0	
list0 title=S_PROM
list0 layout=L37
list0 sql=select prom.nid as id,prom.photo as pphoto,prom.name as name,prom.subject, \
		f_prom_stat_n(prom.nid,'@@@LANG@@@') as pay_coin,'' as chkbox,usrbag.nid as bagid \
		from prom,usrbag \
		where usrbag.type='CLLCT' and usrbag.nuid='@@@NUID@@@' and prom.nid=usrbag.ext_nid and usrbag.stat='t' and prom.type='PROM' \
		order by prom.prior,prom.pay_coin,prom.name,prom.nid
list0 img field=1
list0 hidden field=0,6
list0 chk field=5
list0 tag 5=@@@bagid@@@
list0 link pphoto=,/images/
list0 row act=scr=lite0201&prom_id=@@@id@@@

list1 load=act=load&scr=lite02&_ns=list1
list1 title=S_CUS
list1 layout=L37
list1 sql =select prom.nid as id,prom.photo as pphoto,prom.name as name,prom.subject as subject,\ 
		f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@') as stat,'FLD' as fld,'' as chkbox,usrbag.nid as bagid \
		from prom,usrbag \
		where prom.nid=usrbag.ext_nid \
		and usrbag.nuid='@@@NUID@@@' \
		and usrbag.type='CLLCT' \  
		and prom.type='CHKIN' \
		order by prom.prior,prom.pay_coin desc,prom.name
list1 img field=1
list1 link pphoto=,/images/
list1 hidden field=0,7
list1 chk field=6
list1 tag 6=@@@bagid@@@
list1 value fld='S_SIGNED_IN' if (stat eq 'S_SIGNED_IN');\
	    'S_SIGN_IN' if (1)
list1 row act=scr=lite0202&prom_id=@@@id@@@

;Collect Promotion Details
[lite0201]
;nav0 sql = select name,'S_MAP' as s_map from prom where id='@@@prom_id@@@'
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
nav0 sql = select 'S_PROM_DETAILS'  as promdetails

pop0 layout=P06
pop0 sql=select (case when photo_dtl is null then 'DEFAULT_L.png' else photo_dtl end) as name from prom where nid='@@@prom_id@@@'
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

pop1 layout=P05
pop1 sql=with prom as (select prom.name,prom.pay_coin from prom where prom.nid='@@@prom_id@@@') \
		select 'S_HINT' as hint,val,'S_CANCEL' as cancel,'S_CONFIRM' as confirm,prom.name,prom.pay_coin \
		from lang,prom where lang.fld='st.msg' and lang.key='treasure32.msg' and locale='@@@LANG@@@'
pop1 btn field=2,3
pop1 hidden field=4,5
pop1 act 2=A_CANCEL
pop1 act 3=scr=lite020101&prom_id=@@@prom_id@@@&act=set

list0 layout=L34
list0 sql =with prom as (select prom.name as pname,prom.descr,prom.nid,prom.lk,prom.cllct,prom.share,prom.photo_l \
		from prom where prom.nid='@@@prom_id@@@') \
		select prom.photo_l as pphoto,prom.pname,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'S_EXCHANGE' as btn0,prom.descr as descr,cus.addr as addr,\
		cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,prom.share as share,\
		f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
		f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\	
		f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,\
		'' as btn3act,'' as zoom,f_zoom_show_n('@@@prom_id@@@') as imgstat,'' as imgact \
		from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
		and cus.nid=cus2prom.ncid
list0 img field=0,7,8,9,18
list0 btn field=3
list0 hidden field=13,14,15,16,17,19,20
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 tag btn3=SHARE
list0 act tel=callto://@@@tel@@@
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			   	 'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite020102&prom_id=@@@prom_id@@@)' if (btn1rv eq '0');\
			   		'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
			   	 'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			   	 'I_SHARE_OFF' if (1)
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite020103&prom_id=@@@prom_id@@@)
list0 act btn0=A_POPUP(1)
list0 act btn3=scr=lite020104&prom_id=@@@prom_id@@@&actions=S_EXCHANGE
list0 value zoom='I_ZOOM' if (imgstat eq '1');\
			   	  '' if (1)
list0 link zoom=,   	  			   	  
list0 value imgact='A_POPUP(0)' if (imgstat eq '1');\
            '' if (1)             			   	  
list0 act pphoto=@@@imgact@@@

;list1 load=act=load&scr=lite010101&_ns=list1
;list1 title=S_MOREPROM
;list1 layout=L37
;list1 sql = with t1 as (select cus.type,cus.pnid from prom,cus where prom.ncid=cus.nid and prom.nid='@@@prom_id@@@') \
;			select prom.nid as id,prom.photo as pphoto,prom.name as name,subject, \ 
;					f_prom_stat_n(prom.nid,'@@@LANG@@@') as pay_coin \
;			from prom,cus,t1 \
;			where prom.ncid=cus.nid and prom.type='PROM' and cus.type=t1.type and cus.pnid=t1.pid \
;			and prom.nid != '@@@prom_id@@@' and prom.end_at >= current_timestamp and cur_qty > 0 \
;			order by prom.pay_coin,RANDOM() limit 5
;list1 img field=1
;list1 hidden field=0
;list1 link pphoto=,/images/
;list1 row act=scr=lite010101&prom_id=@@@id@@@

;Collect promotion get
[lite020101]
post sql=select p_pay_coin as pay_coin,p_coin as coin,p_rv as rv,p_pid as pid,p_pname as pname from f_prom_get_n('@@@NUID@@@','@@@prom_id@@@','@@@LANG@@@') as prom
init act=A_POPUP(@@@rv@@@)

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0201&prom_id=@@@prom_id@@@);A_HOMEGET(2)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as fail,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				 and lang.key='treasure33.msg1' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop2 layout=P01
pop2 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg3' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

pop3 layout=P01
pop3 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg2' and locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL

pop4 layout=P01
pop4 sql=select 'S_ERROR' as fail,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='treasure33.msg4' and locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

;Collect promotion like
[lite020102]
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite0201&prom_id=@@@prom_id@@@)

;Collect promotion Collect
[lite020103]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
;init act=A_GET(scr=lite0201&prom_id=@@@prom_id@@@);A_HOMEGET(1)
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0201&prom_id=@@@prom_id@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0201&prom_id=@@@prom_id@@@);A_HOMEGET(1)

;Collect promotion Share
[lite020104]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite020105&prom_id=@@@prom_id@@@)
list0 layout=L36
list0 sql=with prom as (select prom.name as pname, cus.name as cname from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
	and cus2prom.ncid=cus.nid and prom.nid='@@@prom_id@@@'),\
      	def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,val from lang where lang.key='lite01010106.msg' and locale='@@@LANG@@@'),\
        lang as (select lang.val as action from lang where lang.key='@@@actions@@@' and locale='@@@LANG@@@') \
	select lb,val as content,btn1,pname,cname,action from prom,def,lang
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite020105&prom_id=@@@prom_id@@@)

;Collect promotion put
[lite020105]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite0201&prom_id=@@@prom_id@@@)

;Collect Cus Detial
[lite0202]
;nav0 sql = select cus.name as cname,'S_MAP' as s_map from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
;nav0 sql = select cus.name as cname from prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=prom.ncid
nav0 sql = select 'S_CUS_DETAILS' as cusdetails

list0 layout=L34
list0 sql =select prom.photo_l as pphoto,\
		prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'FLD' as btn0,\
		prom.descr||(select val from lang where lang.key='S_CUS_DESC' and lang.locale='@@@LANG@@@') as descr,\
		cus.addr as addr,cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,\
		prom.share as share,'ACT' as act,f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@') as chk_stat,\
		f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
		f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\
		f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,\
		'' as btn3act,prom.chkin_type as chkintype,'' as fld \
		from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
		and cus2prom.ncid=cus.nid and prom.nid='@@@prom_id@@@'
list0 img field=0,7,8,9
list0 btn field=3
list0 hidden field=13,14,15,16,17,20,21
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 tag btn3=SHARE
list0 act tel=callto://@@@tel@@@
list0 value btn0='S_SIGNED_IN' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
				    'S_SIGN_IN'   if (1)
list0 value fld='DIS' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
            		'' if (1)
list0 tag btn0=@@@fld@@@
list0 value act='A_POPUP(0)' if ('@@@chkintype@@@' eq 'QRCODE');\
		'	A_WALKIN(scr=lite020201&prom_id=@@@prom_id@@@)' if (1)		 
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite020202&prom_id=@@@prom_id@@@)' if (btn1rv eq '0');\
			   		'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
		   	'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			'I_SHARE_OFF' if (1)
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite020203&prom_id=@@@prom_id@@@)
list0 act btn0=@@@act@@@
list0 act btn3=scr=lite020204&prom_id=@@@prom_id@@@

pop0 layout=P05
pop0 sql=select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,\
    (select name from cus where cus.nid='@@@cus_code@@@') as cname from lang \
		 where lang.fld='st.msg' and lang.key='lite0303.msg' and lang.locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite020201&prom_id=@@@prom_id@@@&sig=@@A_CODESCAN@@&act=set

;Collect Check in 
[lite020201]
post sql = select p_rv as g_rv,p_pay_coin as g_pay_coin,p_coin as g_coin,p_cname as cname \
		   from f_chkin_n('@@@NUID@@@','@@@prom_id@@@','@@@sig@@@','@@@LANG@@@')
init act = A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msgfail' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msg' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0202&prom_id=@@@prom_id@@@);A_PAGEGET(-1,scr=lite02);A_HOMEGET(3)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0202&prom_id=@@@prom_id@@@)

pop3 layout=P01
pop3 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg3' \
		and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_GET(scr=lite0202&prom_id=@@@prom_id@@@)

pop4 layout=P01
pop4 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish12.msgfail' \
		 and lang.locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

pop5 layout=P01
pop5 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg4' \
                 and lang.locale='@@@LANG@@@'
pop5 btn field=2
pop5 act 2=A_CANCEL

;Collect Cus like
[lite020202]
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite0202&prom_id=@@@prom_id@@@)

;Collect Cus Collect
[lite020203]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
;init act=A_GET(scr=lite0202&prom_id=@@@prom_id@@@);A_HOMEGET(1)
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0202&prom_id=@@@prom_id@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0202&prom_id=@@@prom_id@@@);A_HOMEGET(1)

;Collect Cus Share
[lite020204]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite020205&prom_id=@@@prom_id@@@)

list0 layout=L36
list0 sql=with prom as (select pay_coin,name from prom where prom.nid='@@@prom_id@@@'),\
      def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,val from lang \ 
      where lang.key='lite01020106.msg' and locale='@@@LANG@@@') \
		  select def.lb,def.val as content,def.btn1,prom.pay_coin,prom.name from prom,def
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite020205&prom_id=@@@prom_id@@@)

;Collect Cus put
[lite020205]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite0202&prom_id=@@@prom_id@@@)

;User Bag 
[lite03]
init style=TAB
nav0 sql =select 'S_BAG' as s_bag

list0 title=S_UNUSED
list0 layout=L22

list0 load=act=load&scr=lite03&_ns=list0
list0 sql= select prom.nid as id,usrbag.nid as bagid,prom.photo as pphoto,f_prom_seq(prom.name,usrbag.seq,'@@@LANG@@@') as pname, \
		prom.end_at as end_at,prom.subject as subject \
		  from prom,usrbag \
		  where usrbag.type='PROM' and usrbag.nuid='@@@NUID@@@' and prom.nid=usrbag.ext_nid and usrbag.stat='t' and prom.type='PROM' \
		  and prom.end_at >= current_timestamp \
		  order by prom.prior,prom.end_at,prom.name,usrbag.seq,prom.nid
list0 img field=2
list0 hidden field=0,1
list0 link pphoto=,/images/
list0 row act=scr=lite0301&prom_id=@@@id@@@&bagid=@@@bagid@@@

list1 title=S_USED
list1 layout=L22
list1 load=act=load&scr=lite03&_ns=list1
list1 sql=select prom.nid as id,usrbag.nid as bagid,prom.photo as pphoto,f_prom_seq(prom.name,usrbag.seq,'@@@LANG@@@') as pname, \
		  usrbag.updated_at as updated_at,prom.subject as subject \
		  from prom,usrbag \ 
		  where usrbag.type='PROM' and usrbag.nuid='@@@NUID@@@' and usrbag.stat='f' and usrbag.ext_nid=prom.nid \	  		
		  order by prom.prior,usrbag.updated_at desc,prom.name,prom.nid
list1 img field=2
list1 hidden field=0,1
list1 link pphoto=,/images/
list1 row act=scr=lite0302&prom_id=@@@id@@@&bagid=@@@bagid@@@

list2 title=S_EXPIRED
list2 layout=L22
list2 load=act=load&scr=lite03&_ns=list2
list2 sql= select prom.nid as id,usrbag.nid as bagid,prom.photo as pphoto,f_prom_seq(prom.name,usrbag.seq,'@@@LANG@@@') as pname, \
		  prom.end_at as end_at,prom.subject as subject \
		  from prom,usrbag \
		  where usrbag.type='PROM' and usrbag.nuid='@@@NUID@@@' and prom.nid=usrbag.ext_nid and prom.type='PROM' \
		  and prom.end_at < current_timestamp and usrbag.stat='t'\
		  order by prom.prior,prom.end_at,prom.name,usrbag.seq,prom.nid
list2 img field=2
list2 hidden field=0,1
list2 link pphoto=,/images/
list2 row act=scr=lite0303&prom_id=@@@id@@@

[lite0301]
;nav0 sql = select name,'S_MAP' as s_map from prom where id='@@@prom_id@@@'
;nav0 btn field=1
;nav0 act 1=scr=lite_map&prom_id=@@@prom_id@@@
nav0 sql = select 'S_PROM_DETAILS' as promdetial

pop0 layout=P05
pop0 sql=with prom as (select prom.name as pname from prom where prom.nid='@@@prom_id@@@' ) \
		 select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,prom.pname from lang,prom \
		 where lang.fld='st.msg' and lang.key='lite0301.msg' and locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite030104&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@&qrcode=@@A_CODESCAN@@&act=set

pop1 layout=P05
pop1 sql=with prom as (select prom.name as pname from prom where prom.nid='@@@prom_id@@@') \
		 select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,prom.pname from lang,prom \
		 where lang.fld='st.msg' and lang.key='lite0301.msg2' and lang.locale='@@@LANG@@@'
pop1 btn field=2,3
pop1 hidden field=4
pop1 act 2=A_CANCEL
pop1 act 3=scr=lite030104&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@&qrcode=''&act=set

;pop1 layout=P01
;pop1 sql=select 'S_HINT' as hint,use_descr,'S_OK' as cancel from prom where prom.nid='@@@prom_id@@@'
;pop1 btn field=2
;pop1 act 2=A_CANCEL

list0 layout=L34
list0 sql = with prom as (select prom.name as pname,prom.descr,prom.nid,prom.lk,prom.cllct,prom.share,prom.photo_l,prom.chkin_type,\
		prom.use_descr,t_use,t_use_end from prom where prom.nid='@@@prom_id@@@') \
		select prom.photo_l as pphoto,prom.pname,'' as txt1,'S_USE' as btn0,prom.descr as descr,cus.addr as addr,\
		cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,prom.lk as lk,prom.cllct as collect,prom.share as share,\
		f_prom_like_stat_n('@@@NUID@@@',prom.nid) as btn1rv,'' as btn1act,\
		f_prom_cllct_stat_n('@@@NUID@@@',prom.nid) as btn2rv,\			
		f_prom_share_stat_n('@@@NUID@@@',prom.nid) as btn3rv,'' as btn3act, \
		(select count(1) from prom where prom.nid='@@@prom_id@@@' and \
		current_timestamp between COALESCE(t_use,timestamp '1970-01-01') \
		and COALESCE(t_use_end,timestamp '2050-01-01'))||(select (case chkin_type when 'GENERAL' then '1' \
		else '0' end) from prom ) \
		as btn0rv,'' as btn0act,prom.use_descr,prom.chkin_type as chkin_type\
		from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid \
		and cus2prom.ncid=cus.nid
list0 img field=0,7,8,9,
list0 tag btn3=SHARE
list0 btn field=3
list0 hidden field=13,14,15,16,17,18,19,20,21
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 act tel=callto://@@@tel@@@
list0 value btn1='I_LIKE_ON' if (btn1rv eq '1');\
			   	 'I_LIKE_OFF' if (1)
list0 value btn1act='A_SUBMIT(scr=lite030101&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@)' if (btn1rv eq '0');\
			   		'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 value btn2='I_CLLCT_ON' if (btn2rv eq '1');\
			   	 'I_CLLCT_OFF' if (1)
list0 value btn3='I_SHARE_ON' if (btn3rv eq '1');\
			   	 'I_SHARE_OFF' if (1)
list0 value btn0act='A_POPUP(0)' if (btn0rv eq '10');\
                    'A_POPUP(1)' if (btn0rv eq '11');\
					'A_ALERT(S_HINT,@@@use_descr@@@,S_OK)' if (1)				
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=lite030102&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@)
list0 act btn0=@@@btn0act@@@
list0 act btn3=scr=lite030103&prom_id=@@@prom_id@@@&actions=S_USE&bagid=@@@bagid@@@

;[qrcodecreate]
;nav0 sql=select 'S_USEPROM' as st
;
;list0 layout=L39 
;list0 sql=select '' as img1,'@@@NUID@@@-'@@@prom_id@@@'-@@@bagid@@@' as lbl1,'S_OK' as btn1 
;list0 img field=0
;list0 btn field=2
;list0 link img1=,A_CODEGEN(QRCODE\,@@@NUID@@@-'@@@prom_id@@@'-@@@bagid@@@)
;list0 act btn1=A_HOMEGET(2);A_BACK

[lite0302]
;nav0 sql = select 'S_PROM_DETAILS' as promdetial
;list0 layout=L34
;list0 sql = with prom as (select prom.ncid,prom.name as pname,prom.descr,prom.nid,prom.lk,prom.cllct,prom.share,img.name, \
;		        from prom left outer join (select name from img where img.type='PROM' and size='M' \
;		        and img.ext_nid='@@@prom_id@@@') as img on 1=1 where prom.nid='@@@prom_id@@@') \
;			select prom.name as pphoto,prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'S_RETURN' as btn0,prom.descr as descr,cus.addr as addr,\
;			cus.tel1 as tel,'I_LIKE_OFF' as btn1,'I_CLLCT_OFF' as btn2,'I_SHARE_OFF' as btn3,prom.lk as lk,prom.cllct as collect,prom.share as share \
;			from prom,cus where prom.ncid=cus.nid
;list0 img field=0,7,8,9
;list0 btn field=3
;list0 link btn1=,
;list0 link btn2=,
;list0 link btn3=,
;list0 link pphoto=,/images/
;list0 act tel=callto://@@@tel@@@
;list0 act btn0=scr=lite030201&prom_id=@@@prom_id@@@&cid=@@A_CODESCAN@@&bagid=@@@bagid@@@&act=set 

nav0 sql = select 'S_PROM_DETAILS' as promdetial
list0 layout=L34
list0 sql = select prom.photo_l as pphoto,prom.name,\
	f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'S_RETURN' as btn0,\
	prom.descr as descr,cus.addr as addr, cus.tel1 as tel,'' as btn1,\
	'' as btn2,'' as btn3,'' as lk,'' as collect,'' as share \ 
	from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid and \
	cus.nid=cus2prom.ncid and prom.nid='@@@prom_id@@@'
list0 img field=0,7,8,9
list0 hidden field=13
list0 btn field=3
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 act tel=callto://@@@tel@@@
list0 act btn0=A_POPUP(0)

pop0 layout=P05
pop0 sql=with prom as (select prom.name as pname from prom,cus2prom,cus where prom.nid='@@@prom_id@@@' and cus.nid=cus2prom.ncid and prom.nid=cus2prom.prom_nid) \
		 select 'S_HINT' as s_cngrtltn,lang.val,'S_CANCEL' as cancel,'S_OK' as s_ok,prom.pname from lang,prom \
		 where lang.fld='st.msg' and lang.key='lite0302.msg' and lang.locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite030201&prom_id=@@@prom_id@@@&qrcode=@@A_CODESCAN@@&bagid=@@@bagid@@@&act=set

;return of promotion
[lite030201]
post sql=select p_name as g_pname,p_rv as g_rv,p_cunt as g_qty from f_prom_back_n('@@@NUID@@@','@@@prom_id@@@','@@@bagid@@@','@@@qrcode@@@','@@@LANG@@@')
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030201.msg' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030201.msg1' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_BACK;A_GET(scr=lite03)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg3' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

;promotion out of date 
pop3 layout=P01
pop3 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg4' and locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL

pop4 layout=P01
pop4 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030201.msg2' and locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_BACK;A_GET(scr=lite03)

[lite0303]
nav0 sql = select 'S_PROM_DETAILS' as promdetial
list0 layout=L34
list0 sql =select prom.photo_l as pphoto,prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'S_EXPIRED' as btn0,prom.descr as descr,cus.addr as addr,\
	cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,'' as lk,'' as collect,'' as share \
	from prom,cus,cus2prom where prom.nid=cus2prom.prom_nid and cus.nid=cus2prom.ncid and prom.nid='@@@prom_id@@@'
list0 img field=0,7,8,9
list0 btn field=3
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 act tel=callto://@@@tel@@@
list0 tag btn0=DIS

[lite030101]
post sql=select f_prom_like_n('@@@NUID@@@','@@@prom_id@@@') as g_rv
init act=A_GET(scr=lite0301&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@)

[lite030102]
post sql=select f_prom_cllct_n('@@@NUID@@@','@@@prom_id@@@') as rv
;init act=A_GET(scr=lite0301&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@);A_HOMEGET(1)
init act=A_POPUP(@@@rv@@@)
pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite0301&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010403.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite0301&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@);A_HOMEGET(1)

[lite030103]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite030105&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@)
list0 layout=L36
list0 sql=with prom as (select prom.name as pname, cus.name as cname from prom,cus,cus2prom  where prom.nid=cus2prom.prom_nid \
	and cus2prom.ncid=cus.nid and prom.nid='@@@prom_id@@@'),\
      		   def as (select '' as lb,'' as txt1,'S_SUBMIT' as btn1,val from lang where lang.key='lite01010106.msg' and lang.locale='@@@LANG@@@'),\
      		   lang as (select lang.val as action from lang where lang.key='@@@actions@@@' and lang.locale='@@@LANG@@@') \
		  select lb,val as content,btn1,pname,cname,action from prom,def,lang
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=lite030105&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@)

[lite030105]
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@prom_id@@@') as g_rv
init act=A_BACK;A_GET(scr=lite0301&prom_id=@@@prom_id@@@&bagid=@@@bagid@@@)

;use promotion
[lite030104]
post sql=select p_name as g_pname,p_rv as g_rv,p_cunt as g_qty from f_prom_use_n('@@@NUID@@@','@@@prom_id@@@','@@@bagid@@@','@@@qrcode@@@','@@@LANG@@@')
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg1' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_BACK;A_GET(scr=lite03)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg2' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

pop3 layout=P01
pop3 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg3' and locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL

pop4 layout=P01
pop4 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg4' and locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

pop5 layout=P01
pop5 sql=select 'S_ERROR' as hint,val,'S_OK' as s_ok from lang where lang.fld='st.msg' \
				and lang.key='lite030104.msg5' and locale='@@@LANG@@@'
pop5 btn field=2
pop5 act 2=A_CANCEL

[lite04]
;nav0 sql=select 'S_MORE' as s_more,'S_SETTING' as s_set
nav0 sql=select 'S_MORE' as s_more
;nav0 btn field=1
;nav0 act 1=A_SET

init style=G
list0 layout=L07
list0 sql=with scrdef as (select title,(case title when 'S_SUGGESTION' then 'S_OPINION_AWARD' \
                                                   when 'S_USR_CHKIN' then \ 
                                                   (select lang.val from lang where lang.key='S_SUR_DIS1' and lang.locale='@@@LANG@@@') \ 
                                                   end) as subtitle,act,prior \
		  	                 from scrdef as scr where scr.no = 'lite04'),\
     	usr as (select usr.type,chkin_cunt from usr where usr.nid='@@@NUID@@@') \
		  select (case scrdef.title when 'S_USR_CHKIN' then (select val as title from lang where key='S_USR_CHKIN' and locale='@@@LANG@@@') \
		          else scrdef.title end ), \ 
		          chkin_cunt,\
		  scrdef.subtitle,scrdef.act from scrdef left outer join usr on 1=1 \
		  where case when usr.type is null or usr.type = '' then prior <= 10 \
		  		     when usr.type='ADM' then true \
		  		     when usr.type='SER' then prior <= 10 or  (prior >= 20 and prior <29) \
		  		     when usr.type='DEV' then prior <= 10 or  (prior >= 30 and prior <39) \	
				     when usr.type='SEB' then prior <= 10 or  (prior = 32) \	
		  		     else prior <= 10 end \
		  order by scrdef.prior
list0 hidden field=1,3
list0 row act=@@@act@@@

[lite0401]
post sql=select f_usr_pref_n('@@@NUID@@@','@@@usr_age@@@','@@@usr_sex@@@') as g_rv
init style=G
nav0 sql=select 'S_USRCENTER' as s_usercenter,'S_PWD' as s_pwd
nav0 btn field=1
nav0 act 1=scr=lite040101

pop0 layout=P03
pop0 sql=with lang as (select lang.val,lang.key from cat,lang where cat.code=lang.key \
					  and cat.fld='usr.age' and lang.locale='@@@LANG@@@' order by cat.prior), \
 			   usr as (select age from usr where usr.nid='@@@NUID@@@') \ 
 		 select lang.val,lang.key as usrage,usr.age from lang left outer join usr on lang.key=usr.age
pop0 opt field=1
pop0 hidden field=2
pop0 tag 1=@@@age@@@
pop0 row act=A_SUBMIT(scr=lite0401&usr_age=@@@usrage@@@)

pop1 layout=P03
pop1 sql=with lang as (select lang.val,lang.key from cat,lang where cat.code=lang.key \
						and cat.fld='usr.sex' and lang.locale='@@@LANG@@@' order by cat.prior),\
 				usr as (select sex from usr where usr.nid='@@@NUID@@@') \
		 select lang.val,lang.key as usrsex,usr.sex from lang left outer join usr on lang.key=usr.sex
pop1 opt field=1
pop1 hidden field=2
pop1 tag 1=@@@sex@@@
pop1 row act=A_SUBMIT(scr=lite0401&usr_sex=@@@usrsex@@@)

list0 layout=L07
list0 sql=with usr as (select name,sex,coin,email,age,reg_tel,nid from usr where usr.nid='@@@NUID@@@'),\
			   bmail as (select lang.val from cat,lang where cat.fld='usr.reward' \
			   			 and cat.code='S_BOUND_EMAIL' and lang.key=cat.code and lang.locale='@@@LANG@@@'),\
     		   btel  as (select lang.val from cat,lang where cat.fld='usr.reward' \
     		   			 and cat.code='S_BOUND_PHONE' and lang.key=cat.code and lang.locale='@@@LANG@@@') \
     	         select (case title when 'S_USR_ID' then (select val from lang where key='S_USR_ID' and locale='@@@LANG@@@') \
                       else title end) as title, \
     	                (case title when 'S_USR_ID' then usr.nid \
     	                 when 'S_USRNAME' then usr.name \
		  	               when 'S_COIN' then to_char(usr.coin,'FM9999999999') \ 
		  	               when 'S_AGE' then  usr.age \
		  	               when 'S_SEX' then  usr.sex \
		  	               when 'S_EMAIL' then coalesce(usr.email,bmail.val) \ 
		  	               when 'S_MBL_PHONE_NUM' then  coalesce(usr.reg_tel,btel.val) \ 
     	                 end) as subtitle,act from scrdef as scr,usr,bmail,btel \
   		         where scr.no='lite0401' order by scr.prior
list0 row act=@@@act@@@

[lite040101]
nav0 sql=select 'S_PWD' as s_pwd,'S_SUBMIT' as s_submit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=lite04010101)

list0 layout=L35
list0 sql=select 'S_DESC_PWD' as spwd, '' as cur_pwd,'' as newpwd ,'' as new_pwd_cnfm,'S_SUBMIT' as btn_submit,\
				 hpwd,'' as dis from usr where usr.nid='@@@NUID@@@'
list0 hidden field=5,6
list0 value dis='DIS,' if (hpwd eq '');\
				'' if (1)
list0 txt field=1,2,3
list0 btn field=4
;list0 tag 1=PWD,>5,<13
list0 tag 1=PWD,@@@dis@@@>0
list0 tag 2=PWD,>5,<13
list0 tag 3=PWD,>5,<13,=newpwd
;list0 re 2=^[A-Za-z0-9_-]{6,12}$
;list0 re 3=^[A-Za-z0-9_-]{6,12}$
list0 re 2=^[^\u4e00-\u9fa5]{6,12}$
list0 re 3=^[^\u4e00-\u9fa5]{6,12}$
list0 act 4=A_SUBMIT(scr=lite04010101)

[lite04010101]
post sql=select f_pwd_submit_n('@@@NUID@@@','@@@cur_pwd@@@','@@@newpwd@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				and lang.key='lite04010101.msg1' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,val,'S_OK' as confirm from lang where lang.fld='st.msg' \
				and lang.key='lite04010101.msg' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_BACK;A_GET(scr=lite0401)

[lite040102]
nav0 sql=select 'S_USRNAME' as s_usrname,'S_SUBMIT' as s_sumbmit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=lite04010201)

list0 layout=L40
;list0 sql=with usr  as (select name from usr where code='@@@NUID@@@'),\
;    		   lang as (select lang.val from lang where fld='st.msg' and key='lite040102.msg' and locale='@@@LANG@@@') \
;     select lang.val as introduce,'S_USRNAME1' as nm,usr.name as usrname,'S_SUBMIT' as btn \
;     from lang left outer join usr on 1=1
list0 sql=select 'S_DESC_USRNAME' as introduce,'S_USRNAME1' as nm,usr.name as usrname,'S_SUBMIT' as btn1 from usr \
	  where usr.nid='@@@NUID@@@'
list0 txt field=2
list0 tag 2=>2,<13
;list0 re 2=^[A-Za-z0-9_\-]{3,12}$
;list0 re 2=\b(?!guest)\b[A-Za-z0-9_\-]{3,12}$
list0 re 2=(?!guest)[a-zA-Z0-9_\-]{3,12}$
list0 btn field=3
list0 act btn1=A_SUBMIT(scr=lite04010201)

[lite04010201]
post sql=select f_usrname_set_n('@@@NUID@@@','@@@usrname@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

;pop0 title=S_HINT
pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
				and key='lite04010201.msg' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act submit=A_CANCEL

;pop1 title=S_HINT
pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
				and key='lite04010201.msg1' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act submit=A_BACK;A_GET(scr=lite0401)

[lite040103]
nav0 sql=select 'S_EMAIL' as mail,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=lite04010301)

list0 layout=L41
;list0 sql=select 'S_EMAIL1' as mail,'' as email,'S_SUBMIT' as btn
list0 sql=with usr as (select email  from usr where usr.nid='@@@NUID@@@'),\
				t1 as (select 'S_EMAIL1' as mail,'S_SUBMIT' as btn) \
		  select mail,email,btn from t1 left outer join usr on 1=1 
list0 txt field=1
list0 tag 1=EML,>1,<51
list0 re 1=^(?=\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$).{0,50}$
list0 btn field=2
list0 act btn=A_SUBMIT(scr=lite04010301)

[lite04010301]
post sql=select f_email_set_n('@@@NUID@@@','@@@email@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
				and key='lite04010301.msg' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act submit=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
				and key='lite04010301.msg1' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act submit=A_BACK;A_GET(scr=lite0401)

pop2 layout=P01
pop2 sql=with rwd as (select name as reward from cat where fld='usr.reward' and code='S_BOUND_EMAIL'),\
     		  usr as (select coin from usr where usr.nid='@@@NUID@@@') \
   		 select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit,reward,coin from lang,rwd,usr \
   		        where fld='st.msg' and key='lite04010301.msg2' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 hidden field=3,4
pop2 act submit=A_BACK;A_GET(scr=lite0401)

[lite040104]
nav0 sql=select 'S_MBL_PHONE_NUM' as phone,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=lite04010401)

list0 layout=L41
;list0 sql=select 'S_MBL_PHONE_NUM' as phone,'' as phone_num,'S_SUBMIT' as btn
list0 sql=with usr as (select reg_tel from usr where usr.nid='@@@NUID@@@'),\
     			t1 as (select 'S_MBL_PHONE_NUM1' as phone,'S_SUBMIT' as btn) \
 		select phone,usr.reg_tel,btn from t1 left outer join usr on 1=1 
list0 txt field=1
list0 tag 1=NUM,>5,<21
;list0 re 1=^[\+0-9-]{6,20}$
list0 re 1=^[0-9]{6,20}$
list0 btn field=2
list0 act btn=A_SUBMIT(scr=lite04010401)

[lite04010401]
post sql=select f_phone_set_n('@@@NUID@@@','@@@reg_tel@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
				and key='lite04010401.msg' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act submit=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit from lang where fld='st.msg' \
				and key='lite04010401.msg1' and locale='@@@LANG@@@'
pop1 btn field=2
pop1 act submit=A_BACK;A_GET(scr=lite0401)

pop2 layout=P01
pop2 sql=with rwd as (select name as reward from cat where fld='usr.reward' and code='S_BOUND_PHONE'),\
     		  usr as (select coin from usr where usr.nid='@@@NUID@@@') \
   		 select 'S_SUCC' as hint,lang.val as string,'S_OK' as submit,reward,coin from lang,rwd,usr \
   		        where fld='st.msg' and key='lite04010401.msg2' and locale='@@@LANG@@@'
pop2 btn field=2
pop2 hidden field=3,4
pop2 act submit=A_BACK;A_GET(scr=lite0401)

[lite0402]
post sql=select f_usr_interest_n('@@@NUID@@@','@@@stat@@@','@@@stat.val@@@') as g_rv 
nav0 sql=select 'S_INTEREST' as interest

list0 layout=L03
;list0 sql= with lang as (select val,key,seq from lang  where lang.fld='part.class' and locale='@@@LANG@@@'), \
;      usrpref as (select type,stat from usrpref where NUID='@@@NUID@@@') \ 
;      select lang.val,coalesce(usrpref.stat,'0') as stat,lang.key as key \
;      from lang left outer join usrpref on lang.key=usrpref.type order by lang.seq
list0 sql=select val,case when lang.key in (SELECT regexp_split_to_table(pref_intrst, E',')\
 				from usr where usr.nid='@@@NUID@@@') then '0' else '1'  end as stat,key from lang \
 				where lang.fld='part.class' and locale='@@@LANG@@@' order by lang.seq
list0 hidden field=2
list0 swt field=1
list0 act 1=A_SUBMIT(scr=lite0402)
list0 tag 1=@@@key@@@

[lite0403]
;post sql=select f_sync_set('@@@NUID@@@','@@@stat@@@','@@@stat.val@@@') as g_rv
;post sql=update oauth set sync='@@@stat.val@@@' where code='@@@NUID@@@' and type='WEIBO' and catg='@@@stat@@@'
nav sql=select 'S_SYNCSET' as sync

list0 layout=L03
;list0 sql=with lang as (select lang.val,lang.key,cat.name from cat,lang where cat.fld='oauth.catg' and cat.code=lang.key \
;		  				and lang.locale ='@@@LANG@@@' and prior not in(2,3,4) order by cat.prior), \
;     		   oauth as (select sync,catg from oauth where type='WEIBO' and code ='@@@NUID@@@') \
;		select lang.val as name,coalesce(oauth.sync,'0') as stat,lang.name as site,lang.key as key,oauth.sync,'' as actn \
;		from lang left outer join oauth on lang.key=oauth.catg
list0 sql=select lang.val,'0' as stat,cat.name,lang.key from cat,lang where cat.fld='oauth.catg' and cat.code=lang.key \
		  				and lang.locale ='@@@LANG@@@' and prior not in(2,3,4) order by cat.prior
list0 hidden field=2,3
list0 swt field=1
list0 tag 1=@@@key@@@
list0 act 1=A_OAUTH(@@@key@@@,@@@site@@@,@@@stat@@@)

[lite0404]
nav0 sql=select 'S_SUGGESTION' as suggestion,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act 1=A_SUBMIT(scr=lite040401)

list0 layout=L36
list0 sql=select lang.val as tl,'' as content,'S_SUBMIT' as submit from lang where fld='st.msg' and key='lite0404.msg' and locale='@@@LANG@@@'
list0 txt field=1
list0 tag 1=>0,<201
list0 re 1=^.{1,200}$
list0 btn field=2
list0 act 2=A_SUBMIT(scr=lite040401)

list1 layout=L32
list1 sql=with aboutme as (select support_email from aboutme), \
          lang as (select val from lang where key='S_EMAIL2' and locale='@@@LANG@@@') \
          select val as title,support_email as mail from aboutme,lang where 1=1 
list1 hidden field=2
;list1 act mail=mailto://@@@mail@@@

[lite040401]
post sql=select f_feedback_submit_n('@@@NUID@@@','@@@content@@@') as g_rv,'' as action
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as hint,'S_SUBMIT_FAIL' as fail,'S_OK' as btn1
pop0 btn field=2
pop0 act btn1=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as hint,'S_SUBMIT_SUCC' as succ,'S_OK' as btn1
pop1 btn field=2
pop1 act 2=A_BACK

[lite0405]
nav0 sql=select 'S_HLP_FR_USR' as s_new

list0 layout=L07
list0 sql=select title,act from scrdef where no='lite0405' order by prior
list0 hidden field=1
list0 row act =@@@act@@@

[lite0406]
nav0 sql=select 'S_ABOUT' as about

init style=G
list0 layout=L38
;list0 sql=select introduce from aboutme where id=1
;list0 sql=select 'S_DESC_PROD' as introduce
list0 sql=select lang.val from lang where lang.fld='st.kwrd' and lang.key='S_DESC_VER' and locale='@@@LANG@@@'

list1 layout=L12
list1 sql=with aboutme as (select version,site,addr,tel from aboutme where id=1) \
			   select title,(case when title='S_VER' then aboutme.version \
		  					  when title='S_SITE' then aboutme.site \
		  					  when title='S_ADDR' then aboutme.addr \
		  					  when title='S_SERVICE' then aboutme.tel end ) as subtitle,\
		  					  act from scrdef,aboutme where no='lite0406' order by prior limit 2
list1 hidden field=2
list1 act subtitle=@@@act@@@

[lite0407]
nav0 sql=select 'S_SWTCH_ACCNT' as name,'S_SUBMIT' as btn
nav0 btn field=1
nav0 act 1=A_LOGIN(scr=login)

list0 layout=L42
list0 sql=select 'S_ACCOUNT' as acc,'S_PWD1' as spwd,'' as account,'' as pwd,'S_SUBMIT' as btn1
list0 txt field=2,3
list0 tag 2=S_ACC_HINT,>2,<51
;list0 re 2=^([\d\D]*){3,50}$
list0 re 2=^[A-Za-z0-9_\-\+\@\.]{3,50}$
list0 tag 3=PWD,>5,<13
list0 re 3=^[^\u4e00-\u9fa5]{6,12}$
list0 btn field=4
list0 act btn1=A_LOGIN(scr=login)

[lite0408]
nav0 sql=select val as title from lang where key='S_USR_CHKIN' and locale='@@@LANG@@@' 

list0 layout=L38
list0 sql=select val as desc from lang where key='S_RULE_DESC' and locale='@@@LANG@@@'
         
list1 layout=L07
list1 sql=with chkin as(select u_rules.cunt as ucunt,u_rules.t_cunt as utcunt,c_rules.cunt as ccunt,c_rules.t_cunt as ctcunt, \
                       (select chkin_cunt from usr where usr.nid='@@@NUID@@@') as cur_chk \
                        from (select cunt,t_cunt from rules where key='C0001') as c_rules, \ 
                             (select cunt,t_cunt from rules where key='UC0001') as u_rules) \
               select ucunt,utcunt,ccunt,ctcunt,cur_chk,(select val from lang where key=scrdef.title and locale='@@@LANG@@@') as fld, \
                             (case title when 'S_PERIOD' then (select val from lang where key='S_PERIOD_DIS' and locale='@@@LANG@@@')  \
                                         when 'S_LIMIT' then (select val from lang where key='S_LIMIT_DIS' and locale='@@@LANG@@@') \
                                         when 'S_SURPLUS' then (select val from lang where key='S_SUR_DIS' and locale='@@@LANG@@@') \
                                         when 'S_CUS_PERIOD' then (select val from lang where key='S_CUS_PDIS' and locale='@@@LANG@@@') \
                                         when 'S_CUS_LIMIT' then (select val from lang where key='S_CUS_LDIS' and locale='@@@LANG@@@') \ 
                                         end ) as subtitle \   
                              from scrdef,chkin where scrdef.no='lite0408' order by prior asc                    
list1 hidden field=0,1,2,3,4                   

[loginfail]
init act=A_ALERT(S_HINT,S_CHK_INPUT,S_OK)

[delchkin]
;init act=A_POPUP(0)
;pop0 layout=P05
;pop0 sql=select 'S_HINT' as hint,'Reset chkin hstry' as smore,'S_CANCEL' as btn1,'S_OK' as btn2
;pop0 btn field=2,3
;pop0 act btn1=A_CANCEL
;pop0 act btn2=A_SUBMIT(scr=delchkin1)

;post sql=delete from hstry where hstry.nid=@@@chkbox@@@ and case when @@@chkbox.val@@@=1 then true else false end
post sql=select f_cancel_chkin_n('@@@NUID@@@','@@@chkbox@@@','@@@chkbox.val@@@')
nav0 sql =select 'Cancel Check-In' as chkin, 'S_EDIT1' as s_edit
nav0 btn field=1
nav0 act 1=A_DEL(scr=delchkin)

list0 load=act=load&scr=delchkin&_ns=list0
list0 layout=L37
list0 sql = select cus.nid as id,cus.photo as cphoto,cus.name as pname,cus.addr as addr, \
			f_chkin_stat_n('@@@UID@@@',cus.nid,'@@@LANG@@@') as stat,'FLD' as fld,'' as chkbox,hstry.nid as hstryid \
			from cus,hstry where cus.nid=hstry.ncid and hstry.type='CHKIN' and hstry.nuid='@@@NUID@@@' \
			and hstry.type='CHKIN' order by hstry.nid 
list0 img field=1
list0 link cphoto=,/images/
list0 hidden field=0,7
list0 chk field=6
list0 tag 6=@@@hstryid@@@
list0 value fld='S_SIGNED_IN' if (stat eq 'S_SIGNED_IN');\
			    'S_SIGN_IN' if (1)			    
[cleanhis]

post sql=select f_clean_his('@@@NUID@@@','@@@chkbox@@@','@@@chkbox.val@@@')
nav0 sql =select 'Clean History' as title, 'S_EDIT1' as s_edit
nav0 btn field=1
nav0 act 1=A_DEL(scr=cleanhis)

list0 load=act=load&scr=cleanhis&_ns=list0
list0 layout=L37
list0 sql = select prom.nid as id,prom.photo as photo,cus.name as cname,cus.addr as addr, \
        (select name from cat where code=prom.type and fld='prom.type') as fld,\
        '' as chkbox,hstry.nid as hstryid \
        from hstry left join cus on hstry.ncid=cus.nid \
	left join prom on hstry.mission=prom.nid  \
	where hstry.nuid='@@@NUID@@@' \
        and hstry.type in ('PROM','CHKIN','CNSM','LUCK','LUCK1','WLCM','PRIZE','INVITE') \
        order by hstry.nid
list0 img field=1
list0 link photo=,/images/
list0 hidden field=0,6
list0 chk field=5
list0 tag 5=@@@hstryid@@@

[lite010301]
pop0 layout=P01
pop0 sql=select 'S_ERROR' as err, val, 'S_OK' as confirm from lang where key='lite010301.msg' and locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

nav0 sql = select 'S_ACT_DETAILS' as actdetails
list0 layout=L44
list0 sql = select photo,name,f_task_stat_n('@@@NUID@@@','@@@act_id@@@') as allstat, \
            substr(f_task_stat_n('@@@NUID@@@','@@@act_id@@@'),1,position('|' in f_task_stat_n('@@@NUID@@@','@@@act_id@@@') )-1) as stat, \
            descr,substr(f_task_stat_n('@@@NUID@@@','@@@act_id@@@'),position('|' in f_task_stat_n('@@@NUID@@@','@@@act_id@@@'))+1) as btn0, \
            '' as fld from prom where nid='@@@act_id@@@'
list0 hidden field=2,6
list0 img field=0
list0 link photo=,/images/  
list0 btn field=5
list0 value fld='scr=lite01030101&act_id=@@@act_id@@@&act=set' if ('@@@allstat@@@' eq 'S_DONE|S_GETPRIZE');\
                	'A_POPUP(0)' if ('@@@allstat@@@' eq 'S_UNDONE|S_GETPRIZE');\
                	''  if (1)
list0 act btn0=@@@fld@@@

list1 layout=L37
list1 sql = select prom.photo as pphoto,prom.name,prom.subject as addr,f_taskchkin_stat_n('@@@NUID@@@','@@@act_id@@@',prom.nid) as flag,\
            prom.nid as prom_id \
            from prom,prom2prom \
            where prom.nid=prom2prom.child_id and prom2prom.parent_id='@@@act_id@@@' and prom.type='TCHKIN' \
            order by prom.prior,prom.name,prom.nid
list1 img field=0
list1 link pphoto=,/images/
list1 hidden field=4
list1 row act=scr=lite010302&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@

[lite01030101]
post sql = select p_rv as t_rv,p_count as pcount,p_cname as pcname,p_cid as pid from f_task_get_n('@@@NUID@@@','@@@act_id@@@')
init act = A_POPUP(@@@t_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish11.msgfail' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish11.msg' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010301&act_id=@@@act_id@@@);A_PAGEGET(-1,scr=lite0101&cid=@@@pid@@@);A_HOMEGET(2)

[lite010302]
nav0 sql = select 'S_CUS_DETAILS' as cusdetails

list0 layout=L34
list0 sql = select prom.photo_l as pphoto, \
		prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'FLD' as btn0,prom.descr as descr,cus.addr as addr, \
		cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,'' as fld,'ACT' as act, \
		f_taskchkin_chk_n('@@@NUID@@@','@@@act_id@@@',prom.nid) as chk_stat,prom.chkin_type as chkintype \		
		from prom,prom2prom,cus2prom,cus where prom.nid='@@@prom_id@@@' and prom.nid=prom2prom.child_id \
		and prom2prom.parent_id = cus2prom.prom_nid and cus2prom.ncid=cus.nid limit 1
list0 img field=0,7,8,9
list0 btn field=3
list0 hidden field=10,11,12,13,14
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 act tel=callto://@@@tel@@@
list0 value btn0='S_SIGNED_IN' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
				         'S_SIGN_IN'   if (1)
list0 value fld='DIS' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
                '' if (1)
list0 tag btn0=@@@fld@@@
list0 value act='A_POPUP(0)' if ('@@@chkintype@@@' eq 'QRCODE');\
		'A_WALKIN(scr=lite010303&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@)' if (1)				 
list0 act btn0=@@@act@@@

pop0 layout=P05
pop0 sql=with prom as (select prom.name from prom where prom.nid='@@@prom_id@@@') \
		select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,prom.name from lang,prom \
		where lang.fld='st.msg' and lang.key='lite0303.msg' and locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite010303&prom_id=@@@prom_id@@@&sig=@@A_CODESCAN@@&act_id=@@@act_id@@@&act=set

[lite010303]
post sql = select p_rv as g_rv,p_pay_coin as g_pay_coin,p_coin as g_coin,p_cname as cname,p_pid as pid \
		   from f_task_n('@@@NUID@@@','@@@prom_id@@@','@@@sig@@@','@@@act_id@@@')
init act = A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msgfail' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msg' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010302&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@);A_PAGEGET(-1,scr=lite010301&act_id=@@@act_id@@@);\
A_PAGEGET(-2,scr=lite0101&cid=@@@pid@@@);A_HOMEGET(1)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010302.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite010302&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@)

pop3 layout=P01
pop3 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg3' \
		and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_GET(scr=lite010302&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@)

pop4 layout=P01
pop4 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish12.msgfail' \
		and lang.locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_GET(scr=lite010302&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@)

pop5 layout=P01
pop5 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msg' \
		and lang.locale='@@@LANG@@@'
pop5 btn field=2
pop5 act 2=scr=lite010304&prom_id=@@@prom_id@@@&act_id=@@@act_id@@@&cid=@@@pid@@@&act=set

[lite010304]
post sql = select 0 as g_rv,name as p_task_name from prom where nid='@@@act_id@@@' 
init act = A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish12.msg' \
		 and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_BACK();A_GET(scr=lite010301&act_id=@@@act_id@@@);A_PAGEGET(-1,scr=lite0101&cid=@@@cid@@@);A_HOMEGET(1)

[lite0409]
init style=G
nav0 sql = select 'Device Link' as title

list0 layout=L40
list0 sql=select (select 'Name:' || coalesce(cus.name,'') || ' Mall:'||coalesce(pcus.name,'') \
				 || ' Tel: '||coalesce(cus.tel1,'') || ' Addr: ' || coalesce(cus.addr,'') \
						from  cus,dev2cus,cus as pcus \ 
			   			where cus.nid=dev2cus.cus_nid and pcus.nid=cus.pnid \
			   			and dev2cus.dev_uid='@@@qrcode@@@' limit 1) as title,'' as t1,'' as tx,'' as btn0,\
			   	(select cus.nid as code from  cus,dev2cus \ 
			   			where cus.nid=dev2cus.cus_nid \
			   			and dev2cus.dev_uid='@@@qrcode@@@' limit 1) as code,'' as btnact
list0 btn field=3
list0 txt field=2
list0 tag tx=DIS
list0 hidden field=4,5
list0 act btn0=@@@btnact@@@
list0 value btnact='A_SUBMIT(scr=lite0409&qrcode=@@A_CODESCAN@@)' if (code eq ''); \
				'scr=lite040901&cid=@@@code@@@' if (1)
list0 value btn0='Camera' if (code eq '');\
				 'S_SUBMIT' if (1)	

[lite040901]
nav0 sql = select 'Device Code' as title

list0 layout=L40
list0 sql= select (select lang.val from lang where lang.fld='st.kwrd' and lang.key='S_WKIN_INPUT1' and locale='@@@LANG@@@') as val,\
			'Check Walkin Code:' as tl,'@@@sig@@@' as sigcode,'S_SUBMIT' as btn0,'' as btnact, \
			(select cus.nid from cus where cus.nid='@@@cid@@@') as code			 
list0 btn field=3
list0 txt field=2
list0 tag sigcode=DIS
list0 hidden field=4,5
list0 value btnact='A_WALKIN(scr=lite040901&cid=@@@code@@@)' if (sigcode eq '' || '@@@cid@@@' eq ''); \
		'A_SUBMIT(scr=lite040902&cid=@@@code@@@)' if (1)
list0 act btn0=@@@btnact@@@

list0 value btn0='Search' if ('@@@sig@@@' eq '' || '@@@cid@@@' eq '' );\
				 'S_SUBMIT' if (1)	

[lite040902]
post sql=select p_cname as cname,p_sig as sigcode,p_rv as g_rv from f_chkcode_upload_n('@@@NUID@@@','@@@sigcode@@@','@@@cid@@@') as g_rv
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite040902.msg' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite040902.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_BACK;A_BACK;

pop2 layout=P01
pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite040902.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

[lite0410]

post sql=select p_cname as cname,p_pname as pname,p_usr as usr,p_rv as g_rv from f_gift_code_n('@@@NUID@@@','@@@sig@@@')
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite041001.msg0' \
		and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite041001.msg1' \
		and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite04)

pop2 layout=P01
	pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite041001.msg2' \
		and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_CANCEL

pop3 layout=P01
pop3 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite041001.msg3' \
		and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_CANCEL

pop4 layout=P01
pop4 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite041001.msg4' \
		and lang.locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

;;add by wonderful
[lite010104]
nav0 sql = select 'S_ACT_DETAILS' as promdetial

list0 layout=L34
list0 sql = select prom.photo_l as pphoto, \
	prom.name,f_prom_coin_n(prom.nid,'@@@LANG@@@') as coin,'FLD' as btn0,prom.descr as descr,cus.addr as addr, \
	cus.tel1 as tel,'' as btn1,'' as btn2,'' as btn3,'' as fld,'ACT' as act, \
	f_chkin_stat_n('@@@NUID@@@',prom.nid,'@@@LANG@@@') as chk_stat,prom.chkin_type as chkintype \
	from prom,cus2prom,cus where prom.nid='@@@act_id@@@' and prom.nid = cus2prom.prom_nid \
	and cus2prom.ncid=cus.nid
list0 img field=0,7,8,9
list0 btn field=3
list0 hidden field=10,11,12,13,14
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 link pphoto=,/images/
list0 act tel=callto://@@@tel@@@
list0 value btn0='S_EXCHANGED' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
	         'S_EXCHANGE'  if (1)
list0 value fld='DIS' if ('@@@chk_stat@@@' eq 'S_SIGNED_IN');\
                '' if (1)
list0 tag btn0=@@@fld@@@
list0 value act='A_POPUP(0)' if ('@@@chkintype@@@' eq 'QRCODE');\
		'A_WALKIN(scr=lite01010401&act_id=@@@act_id@@@)' if (1)				 
list0 act btn0=@@@act@@@

pop0 layout=P05
pop0 sql=with prom as (select prom.name,cus.pnid from prom,cus,cus2prom where prom.nid='@@@act_id@@@' \
	and cus.nid=cus2prom.ncid and prom.nid=cus2prom.prom_nid ) \
	select 'S_HINT' as s_cngrtltn,val,'S_CANCEL' as cancel,'S_OK' as s_ok,prom.name,pnid from lang,prom \
	where lang.fld='st.msg' and lang.key='lite0303.msg' and locale='@@@LANG@@@'
pop0 btn field=2,3
pop0 hidden field=4
pop0 act 2=A_CANCEL
pop0 act 3=scr=lite01010401&act_id=@@@act_id@@@&sig=@@A_CODESCAN@@&act=set

[lite01010401]
post sql = select p_rv as g_rv,p_pay_coin as g_pay_coin,p_coin as g_coin,p_cname as cname,p_pid as pid \
                from f_chkin_n('@@@NUID@@@','@@@act_id@@@','@@@sig@@@','@@@LANG@@@')
init act = A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish10.msgfail' \
                and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_SUCC' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite01010401.msg1' \
                and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=lite010104&act_id=@@@act_id@@@);A_PAGEGET(-1,scr=lite0101&cid=@@@pid@@@);A_HOMEGET(1);A_HOMEGET(3)

pop2 layout=P01
pop2 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg2' \
                and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=lite010104&act_id=@@@act_id@@@)

pop3 layout=P01
pop3 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg3' \
                and lang.locale='@@@LANG@@@'
pop3 btn field=2
pop3 act 2=A_GET(scr=lite010104&act_id=@@@act_id@@@)

pop4 layout=P01
pop4 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='fish12.msgfail' \
                 and lang.locale='@@@LANG@@@'
pop4 btn field=2
pop4 act 2=A_CANCEL

pop5 layout=P01
pop5 sql=select 'S_ERROR' as error,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite010202.msg4' \
                 and lang.locale='@@@LANG@@@'
pop5 btn field=2
pop5 act 2=A_CANCEL

pop6 layout=P01
pop6 sql=select 'S_ERROR' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite01010401.msg0' \
                and lang.locale='@@@LANG@@@'
pop6 btn field=2
pop6 act 2=A_CANCEL

pop7 layout=P01
pop7 sql=select 'S_ERROR' as succ,val,'S_OK' as s_ok from lang where lang.fld='st.msg' and lang.key='lite01010401.msg2' \
                and lang.locale='@@@LANG@@@'
pop7 btn field=2
pop7 act 2=A_CANCEL


;;;;;;;;;;;ics_begin;;;;;;;;;;;;;
[usr]
local,req,upd
local=usr
req=scr=usr
upd=scr=usr_upd_base
item0 sql=select alias,age,nid,coin,pref_intrst,email,\
	reg_tel,COALESCE(email,'no') as email_st,\
	COALESCE(reg_tel,'no') as tel_st,sex,type \
	from usr \
	where usr.nid='@@@NUID@@@' 
item0 row id=@@@nid@@@

[usr_upd_base]
err=@@@p_rv@@@
post sql=select p_rv from f_usr_mod_base('@@@NUID@@@','@@@name@@@','@@@email@@@','@@@tel@@@',\
					 '@@@sex@@@','@@@intrst@@@','@@@age@@@','@@@reg_tel@@@')

[usr_mod_pwd]
err=@@@p_rv@@@
post sql=select p_rv from f_usr_mod_pwd('@@@NUID@@@','@@@opwd@@@','@@@npwd@@@')

[usr_hstry]
local,req,del,upd
local=usr_hstry
req=scr=usr_hstry
upd=scr=prom_back&_id=&qrcode=
del=scr=usr_hstry_del&_id=
item0 sql=select nid,msg,type,stat,pact from f_get_usr_msg_n('@@@NUID@@@','@@@tline@@@')
item0 hidden field=0,3,4
item0 row act=@@@pact@@@
item0 row id=@@@nid@@@
item0 tag type=@@@stat@@@

[usr_hstry_del]
item0 sql=update hstry set del_flag=true where nid='@@@_id@@@'

;oauth认证信息
[usr_oauth]
err=@@@p_rv@@@
post sql=select p_rv from f_usr_oauth('@@@NUID@@@','@@@oauth_site@@@','@@@oauth_id@@@','@@@oauth_name@@@',\
				'@@@oauth_link@@@','@@@oauth_token@@@','@@@oauth_refresh@@@')

[prom_back01]
init act=A_POPUP(0)

pop0 layout=L66
pop0 sql=select 'S_RETURN' as title,\
	(select val from lang where locale='@@@LANG@@@' and key='S_RETURN_DESC') as desc, \
	now() as backtime,'' as btn1
pop0 btn field=3
pop0 value btn1='S_SIGN_IN'
pop0 act btn1=A_WALKIN(scr=prom_back02&_id=@@@_id@@@)

[prom_back02]
err=@@@g_rv@@@
post sql=select p_hid,p_rv as g_rv,p_name as g_name,p_cunt as g_qty \
                from f_prom_back_new('@@@NUID@@@','@@@_id@@@','@@@sig@@@','@@@LANG@@@')

list0 update=usr_hstry
list0 sql=select nid,content,'S_'||type as type,stat,'' as fld from hstry where nid='@@@p_hid@@@'
list0 hidden field=0,3,4
list0 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
	'' if (1)
list0 row act=@@@fld@@@
list0 row id=@@@nid@@@
list0 tag type=@@@stat@@@

list1 update=usr
list1 sql=select alias,age,nid,coin,pref_intrst,email,\
	reg_tel,COALESCE(email,'no') as email_st,\
	COALESCE(reg_tel,'no') as tel_st,sex \
	from usr \
	where usr.nid='@@@NUID@@@'
list1 row id=@@@nid@@@

[usr_msg_center]
local,req,del
local=usr_msg_center
req=scr=usr_msg_center
del=scr=usr_msg_del

update=usr_msg_center
item0 sql=select sender,subject,content,created_at,'I_MSG' as pic1,id \
	 from f_msg_center('@@@NUID@@@','@@@tline@@@','ALL')
item0 row id=@@@id@@@
item0 img field=4
item0 link pic1=,

[usr_msg_del]
err=@@@g_rv@@@
post sql=select p_rv as g_rv from f_msg_del('@@@_id@@@')

[usr_card]
local,upd,req
local=usr_card
req=scr=usr_card
upd=scr=usr_card_add&uname=&no=&type=
item0 sql=select usr2card.card_no,usr2card.username,card.type,\
	'I_'||card.type as photo,usr2card.flag \
	from card left join usr2card on usr2card.card_nid=card.nid \
	and usr2card.usr_nid='@@@NUID@@@'
item0 hidden field=
item0 img field=3
item0 link photo=,
item0 row id=@@@type@@@

[usr_card_add]
err=@@@p_rv@@@
post sql=select p_rv from f_usr_card('@@@NUID@@@','@@@uname@@@','@@@no@@@','@@@type@@@');

[shake01]
item0 sql=update usr set shake_cnt=@@@_count@@@ where usr.nid='@@@NUID@@@' returning 0;

[be_invite]
err=@@@p_rv@@@
post sql=select p_rv from f_invite('@@@NUID@@@','@@@uid@@@',1,'@@@LANG@@@');

list0 update=usr
list0 sql=select alias,age,nid,coin,pref_intrst,email,\
        reg_tel,COALESCE(email,'no') as email_st,\
        COALESCE(reg_tel,'no') as tel_st,sex \
        from usr \
        where usr.nid='@@@NUID@@@'
list0 row id=@@@nid@@@


[usr_city]
post sql=update usr set city='@@@cur_city@@@' where usr.nid='@@@NUID@@@'

item0 sql=select lang.val from usr,lang where usr.nid='@@@NUID@@@' \
        and lang.fld='pty.city' and lang.key=usr.city and lang.locale='@@@LANG@@@'

;usr01 add by wonderful 2012-10-04
[usr01]
list0 local=usr
list0 req=scr=usr
list0 upd=scr=usr_upd_base
list0 sql=select alias,age,nid,coin,pref_intrst,email,\
        reg_tel,COALESCE(email,'no') as email_st,\
        COALESCE(reg_tel,'no') as tel_st,sex \
        from usr \
        where usr.nid='@@@NUID@@@'
list0 row id=@@@nid@@@

list1 local=usr_hstry
list1 req=scr=usr_hstry
list1 upd=scr=prom_back&_id=&qrcode=
list1 del=scr=usr_hstry_del&_id=
list1 sql=select nid,msg,type,stat,pact from f_get_usr_msg_n('@@@NUID@@@')
list1 hidden field=0,3,4
list1 row act=@@@pact@@@
list1 row id=@@@nid@@@
list1 tag type=@@@stat@@@

list2 local=usr_msg_center
list2 req=scr=usr_msg_center
list2 del=scr=usr_msg_del
list2 sql=select sender,subject,content,created_at,'I_MSG' as pic1,id \
         from f_msg_center('@@@NUID@@@',null,'ALL')
list2 row id=@@@id@@@
list2 img field=4
list2 link pic1=,

list3 local=usr_card
list3 req=scr=usr_card
list3 upd=scr=usr_card_add&uname=&no=&type=
list3 sql=select usr2card.card_no,usr2card.username,card.type,\
        'I_'||card.type as photo,usr2card.flag \
        from card left join usr2card on usr2card.card_nid=card.nid \
        and usr2card.usr_nid='@@@NUID@@@'
list3 img field=3
list3 link photo=,
list3 row id=@@@type@@@

[ics01]
style=G
post sql=update usr set city='@@@cur_city@@@' where usr.nid='@@@NUID@@@'

nav0 sql=select 'I_CLLCT' as cllct,'I_ST' as logo,lang.val as city \ 
	from usr,lang \
	where usr.nid='@@@NUID@@@' \
	and lang.key=usr.city \
	and lang.locale='@@@LANG@@@'
nav0 img field=1
nav0 btn field=0,2
nav0 link logo=,
nav0 link cllct=,
nav0 val logo=S_IST
nav0 act cllct=scr=ics03
nav0 act city=scr=city02

list0 layout=L53
list0 sql=select pic,title,act,'' as pic_act,scrdef.country as country \
	from scrdef,city \
	where scrdef.country=city.country \
	and (case when '@@@CITY@@@'<>'' then city.code='@@@CITY@@@' else city.code='S_TPE' end) \
	and (case when '@@@OS@@@' = 'ios' and '@@@APPVER@@@'='1.1.2' then \
	scrdef.os='ios' and scrdef.app_ver='1.1.2' else \
	scrdef.os='android' and scrdef.app_ver='1.1.2' end ) \
	and prj ~* 'ics' order by prior
list0 img field=0
list0 link pic=,
list0 hidden field=1,2,3,4
list0 row act=@@@act@@@
list0 row id=@@@title@@@

list1 layout=L25
list1 style=HS
list1 sql=select prom.npid,prom.ncid,prom.photo,prom.type,'' as action,prom.act \
	from f_adv_show_n('@@@NUID@@@','@@@IP@@@',0,3) as prom
list1 img field=2
list1 hidden field=0,1,3,4,5
list1 link photo=,/images/
list1 tag photo=@@@type@@@
list1 value action='scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@' if (type eq 'ADVT');\
	'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'WLCM');\
	'scr=ics01010116&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'CNSM');\
	'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'LUCK');\
	'scr=ics01010113&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'TICKET');\
	'@@@act@@@' if (1)
list1 act photo=@@@action@@@

bar0 sql=select 'I_BAR_ICS_HOME' as home,'I_BAR_ICS_EXCHANGE' as exchange, \
	'I_BAR_ICS_ME' as me,'I_BAR_ICS_MORE' as more
bar0 height=44
bar0 btn field=0,1,2,3
bar0 link home=,
bar0 link exchange=,
bar0 link me=,
bar0 link more=,
bar0 act 0=scr=ics01
bar0 act 1=scr=ics02
bar0 act 2=scr=ics04
bar0 act 3=scr=ics05

[adv01]
list0 layout=L25
list0 style=HS
list0 sql=select prom.npid,prom.ncid,prom.photo,prom.type,\
	(case when trim(prom.type)='ADVT' \
	 then (case when  '@@@OS@@@'='ios' and '@@@APPVER@@@'='1.1.2' then \
		'scr=ics01010103' else \
		'scr=ics01010117' end) \
	 when trim(prom.type)='WLCM' \
	 then (case when  '@@@OS@@@'='ios' and '@@@APPVER@@@'='1.1.2' then \
                'scr=ics01010105' else \
                'scr=ics01010110' end) \
	 when trim(prom.type)='CNSM' \
         then (case when  '@@@OS@@@'='ios' and '@@@APPVER@@@'='1.1.2' then \
                'scr=ics01010104' else \
                'scr=ics01010116' end) \
         when trim(prom.type)='LUCK' \
         then (case when  '@@@OS@@@'='ios' and '@@@APPVER@@@'='1.1.2' then \
                'scr=ics01010106' else \
                'scr=ics01010110' end) \
	when trim(prom.type)='TICKET' \
	then  'scr=ics01010113' \
	else prom.act end) as action,'' as act1 \
        from f_adv_show_n('@@@NUID@@@','@@@IP@@@',0,3) as prom
list0 img field=2
list0 hidden field=0,1,3,4,5
list0 link photo=,/images/
list0 tag photo=@@@type@@@
list0 value act1='@@@action@@@&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' \
		  if (type eq 'ADVT' || type eq 'WLCM' || type eq 'CNSM' || \
		      type eq 'LUCK' || type eq 'TICKET');\
		 '@@@action@@@' if (1)
list0 act photo=@@@act1@@@

[city01]
;local,req,update
;local=city
;req=scr=city
;upd=scr=ics01&cur_city=&act=set
item0 sql=select lang.val,lang.key as key,'I'||substr(lang.key,2) as bg, \
	(case when lang.key=usr.city then 1 else 0 end) as prior \
	from usr,lang,city where usr.nid='@@@NUID@@@' \
        and lang.key=city.code \
        and city.show=true \
 	and lang.fld='pty.city' and lang.locale='@@@LANG@@@' \
	order by lang.seq asc
item0 img field=2,
item0 link photo=,
item0 hidden field=1,3
item0 row id=@@@key@@@

[city02]
nav0 sql=select 'S_SWITCH_CITY' as sw_ct
init style=G
list0 title=S_CURCITY
list0 layout=L06
list0 sql=select lang.val from usr,lang where usr.nid='@@@NUID@@@' \
        and lang.fld='pty.city' and lang.key=usr.city and lang.locale='@@@LANG@@@'

list1 title=S_MAJORCITY
list1 layout=L06
list1 sql=select lang.val,lang.key from lang,usr,city where usr.nid='@@@NUID@@@' \
	and lang.key=city.code \
	and city.show=true \
        and usr.city !=lang.key and lang.fld='pty.city' and lang.locale='@@@LANG@@@' \
        order by lang.seq,lang.key
list1 hidden field=1
list1 row act=A_HOME(0,scr=ics01&cur_city=@@@key@@@)

[act_rec01]
err=@@@g_rv@@@
post sql=insert into act_rec(usr_nid,act,created_at) VALUES ('@@@NUID@@@' ,'@@@req@@@','@@@time@@@') returning  '1' as p_rv 

list0 sql=select '@@@p_rv@@@' as g_rv
[login01]
;program name=_login('init01','loginfail')
program name=_login('blank','loginfail')
[blank]

[init01]
;*****README*****************
;lbl[0] is key
;lbl[1] is value
;lbl[2] attribute is url
;iist local is category code 
;****************************

;example
list0 title=S_CHANNEL
list0 local=index
list0 sql=select 'I_'||title as pic,title,act \
		from scrdef,city \
		where scrdef.country=city.country \
		and city.code='@@@CITY@@@' \
		and prj ~* 'ics' order by prior
list0 link pic1=,
list0 link pic2=,/images/

;promotion froma
list1 title=S_BANK
list1 local=bank
list1 sql=select lang.key,lang.val,prom_src.photo,prom_src.photo as photo2 \
        from prom_src,lang,country2city \
        where lang.fld='prom_src' \
        and prom_src.key=lang.key \
        and lang.locale='@@@LANG@@@' \
	and prom_src.country_code=country2city.country \
	and country2city.city=substr('@@@CITY@@@',3) \
	order by prom_src.prior
list1 link photo2=,/images/
list1 img field=2
list1 link photo=,/images/

;user preferences
list2 title=S_CUS_TYPE
list2 local=favorite
list2 sql=select cat.code,cat.act as ract,cat.tag as rtag,lang.val,\
	cat.photo,cat.photo1 \
        from cat,lang \
        where cat.code=lang.key \
	and lang.locale='@@@LANG@@@' \
	and cat.fld='part_class' \
	and lang.fld='part.class' \
	order by lang.seq
list2 hidden field=1,2
list2 act code=@@@ract@@@
list2 tag code=@@@rtag@@@
list2 link photo=,
list2 link photo1=,

;user age
list3 title=S_MOD_AGE
list3 local=usr_age
list3 sql=select cat.code,cat.act as ract,cat.tag as rtag,lang.val,\
	cat.photo,cat.photo1 \
        from cat,lang \
        where cat.code=lang.key \
        and lang.locale='@@@LANG@@@' \
        and cat.fld='usr_age' \
        order by lang.seq
list3 hidden field=1,2
list3 act code=@@@ract@@@
list3 tag code=@@@tag@@@
list3 link photo=,
list3 link photo1=,

;channel category
list4 title=S_CHANNEL
list4 local=channel
list4 sql=select lang.key,lang.val \
        from lang,cat \
        where lang.fld=cat.fld \
	and cat.code=lang.key \
	and cat.fld='channel' \
        and lang.locale='@@@LANG@@@' order by cat.prior

list5 title=S_CARD
list5 local=card
list5 sql=select type,name,photo,photo1 as pic \
	from card
list5 link photo=,
list5 link pic=,

list6 title=S_CITY
list6 local=city
list6 sql=select key,val \
	from city,lang \
	where city.code=lang.key \
	and lang.fld='pty.city' \
	and lang.locale='@@@LANG@@@'

list7 title=S_REGION
list7 local=region
list7 sql=select code,name \
	from cat \
	where fld='cus.region'

list8 title=S_MOD_SEX
list8 local=sex
list8 sql=select cat.code,cat.act as ract,cat.tag as rtag,cat.name,\
	cat.photo,cat.photo1 \
	from cat \
	where fld='usr_sex' \
	order by prior
list8 hidden field=1,2
list8 act code=@@@ract@@@
list8 tag code=@@@rtag@@@
list8 link photo=,
list8 link photo1=,

list9 title=S_FLOOR
list9 local=floor
list9 sql=select cat.code,cat.name \
	from cat \
	where cat.fld='cus.floor' \
	order by prior

;list10 local=inv
;list10 sql=select 'inv_date' as inv_date,'inv_no' as inv_no,'inv_amount' as inv_amount,'id' as id,\
;	'' as chkbox,'' as btn0,'' as fld,'inv_stat' as stat 
;list10 hidden field=3,6,8
;list10 btn field=5
;list10 act btn0=@@@fld@@@
;list10 chk field=4
;list10 tag chkbox=
;list10 row id=

[ics0101]
list0 layout=L54
list0 load=act=load&scr=ics0101&_ns=list0
list0 sql=select cus.nid as nid,cus.name,cus.pic1,cus.seq \
	from cus where channel='MALL' \
	and channel_flag='1' \
	and store_flag='0'  \
        and cus.area='@@@CITY@@@' \
	and stat='t' \
	order by cus.seq,cus.name,cus.nid
list0 hidden field=0,3
list0 img field=2
list0 link pic1=,/images/
list0 row act=scr=ics010101&cid=@@@nid@@@&x=@@x@@&y=@@y@@

[ics0102]
nav0 sql=select 'S_'||'@@@channel@@@'  as channel
init act=A_LISTAPPEND(scr=ics0102&channel=@@@channel@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@,bank)
style=TAB

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=ics0102&sbo=@@@sbo@@@&_key=@@@_key@@@&channel=@@@channel@@@&x=@@x@@&y=@@y@@)

list0 layout=L55
list0 title=S_ALL 
list0 load=act=load&scr=ics0102&_ns=list0&_key=@@@_key@@@&sbo=@@@sbo@@@&channel=@@@channel@@@&x=@@x@@&y=@@y@@
list0 sql=select cus.nid as ncid,cus.pic2,cus.name,cus.addr,\
        f_distance('POINT(@@@X@@@ @@@Y@@@)','POINT('||x||' '||y||')') as dis, \
        'local.bank;'||cus.prom_src as prom_src,cus.seq as seq,cus.sign,'' as fld \
        from cus \
	where (case when '@@@_key@@@' = '' or '@@@_key@@@' = 'S_ALL' then true \
	else cus.prom_src ilike '%@@@_key@@@%' end) \
        and cus.store_flag='1' \
	and cus.channel_flag='1' \
        and cus.area='@@@CITY@@@' \
        and cus.stat='t' \
        and cus.channel='@@@channel@@@' \
	and (case when '@@@sbo@@@' <> '' \
                then cus.name  ilike '%@@@sbo@@@%'  \
		or cus.addr ilike '%@@@sbo@@@%' \
                else true end) \
        group by cus.nid,cus.pic1,cus.name,cus.addr,dis \
        order by cus.seq nulls last,dis asc nulls last,cus.nid desc 
list0 hidden field=0,6,8
list0 img field=1,5
list0 link pic2=,/images/
list0 link prom_src=,
list0 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
	'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list0 row act=@@@fld@@@

[ics0103]
list0 layout=L54
list0 load=act=load&scr=ics0103&_ns=list0
list0 sql=select distinct (prom_src.key) as key,lang.val,prom_src.photo,prom_src.prior \
        from prom_src,lang \
	where prom_src.country_code= \
	(select country from country2city where city=substr('@@@CITY@@@',3)) \
	and prom_src.key=lang.key \
	and lang.fld='prom_src' \
	and lang.locale='@@@LANG@@@' \
	order by prior nulls last
list0 hidden field=0,3
list0 img field=2
list0 link photo=,/images/
list0 row act=scr=ics010102&skey=@@@key@@@&x=@@x@@&y=@@y@@

;台北百货连锁
[ics0104]
nav0 sql=select 'S_MALL' as title

list0 layout=L54
list0 load=act=load&scr=ics0104&_ns=list0&x=@@x@@&y=@@y@@
list0 sql=select cus.nid as nid,cus.name,cus.pic1,cus.seq,\
        f_distance('POINT(@@@X@@@ @@@Y@@@)','POINT('||cus.x||' '||cus.y||')') as dis,'' as fld,city.country \
        from cus,city \
        where channel='MALL' \
        and channel_flag='1' \
        and store_flag='0'  \
        and cus.area='@@@CITY@@@' \
        and city.code='@@@CITY@@@' \
        and stat='t' \
        order by dis asc nulls last,cus.seq asc nulls last,cus.name,cus.nid
list0 hidden field=0,3,5,6
list0 img field=2
list0 link pic1=,/images/
list0 value fld='scr=ics010103&cid=@@@nid@@@' if ('@@@country@@@' eq 'TW'); \
        'scr=ics010101&cid=@@@nid@@@&x=@@x@@&y=@@y@@' if (1)
list0 row act=@@@fld@@@

;新增演示页面
[ics0105]
nav0 sql=select 'S_MALL' as title

init act=A_LISTAPPEND(scr=ics0105&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@,bank)
style=TAB

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=ics0105&sbo=@@@sbo@@@&x=@@x@@&y=@@y@@)
sbo0 act flr=

list0 layout=L55
list0 title=S_ALL
list0 load=act=load&scr=ics0105&_ns=list0&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@
list0 sql=select * from  \
        (select distinct cus.nid as ncid,cus.pic2,cus.name,cus.addr, \
        f_distance('POINT(@@@X@@@ @@@Y@@@)','POINT('||x||' '||y||')')::varchar as dis,\
        'local.bank;'||cus.prom_src as prom_src,cus.seq,\
	cus.sign,cus.floor \
        from cus \
        where cus.area='@@@CITY@@@' \
        and (case when '@@@_key@@@'='S_ALL' or '@@@_key@@@' = '' then true else cus.prom_src ilike '%@@@_key@@@%' end) \
        and (case when '@@@sbo@@@' <> '' then cus.name ilike '%@@@sbo@@@%' \
        or cus.addr ilike '%@@@sbo@@@%' else true end) \
        and cus.store_flag=false \
        and cus.stat='t') as foo \
        order by case when dis ~* '^\d+$' then dis::integer else floor end nulls last, \
        seq nulls last,ncid
list0 hidden field=0,6,8
list0 img field=1,5
list0 link pic2=,/images/
list0 link prom_src=,
list0 row act=scr=ics01010111&ncid=@@@ncid@@@

;from ics0101
[ics010101]
nav0 sql=select name from cus where nid='@@@cid@@@'
init act=A_LISTAPPEND(scr=ics010101&cid=@@@cid@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@,bank)
style=TAB

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=ics010101&sbo=@@@sbo@@@&cid=@@@cid@@@&x=@@x@@&y=@@y@@)
sbo0 act flr=

list0 layout=L55
list0 title=S_ALL
list0 load=act=load&scr=ics010101&_ns=list0&cid=@@@cid@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@
;list0 sql=select ncid,pic1,name,descr,dis,prom_src,seq,sign \
;	from f_act_data('SCR','ics010101','list0',array['@@@cid@@@','@@@CITY@@@','@@@sbo@@@','@@@_key@@@','1.0','1.0'],null::cus_list01)
list0 sql=select * from \
	(select distinct cus.nid as ncid,cus.pic2,cus.name,cus.addr,\
        (case when '@@@_key@@@' = '' or '@@@_key@@@'='S_ALL' then cus.floor||'F' \
        else f_distance('POINT(@@@X@@@ @@@Y@@@)', \
        'POINT('||x||' '||y||')')::varchar  end) as dis,\
        'local.bank;'||cus.prom_src as prom_src,\
        cus.seq,cus.sign,cus.floor \
	from cus \
        where cus.pnid='@@@cid@@@' \
        and cus.area='@@@CITY@@@' \
        and (case when '@@@_key@@@'='S_ALL' or '@@@_key@@@' = '' then true else cus.prom_src ilike '%@@@_key@@@%' end) \
        and (case when '@@@sbo@@@' <> '' then cus.name ilike '%@@@sbo@@@%' \
	or cus.addr ilike '%@@@sbo@@@%' else true end) \
        and cus.store_flag='1' \
        and cus.stat='t') as foo\
	order by case when dis ~* '^\d+$' then dis::integer else floor end nulls last, \ 
	seq nulls last,ncid
list0 hidden field=0,6,8
list0 img field=1,5
list0 link pic2=,/images/
list0 link prom_src=,
list0 row act=scr=ics01010101&ncid=@@@ncid@@@

;list1 layout=L55
;list1 title=S_HOT
;list1 load=act=load&scr=ics010101&_ns=list0&cid=@@@cid@@@
;list1 sql=select ncid,pic1,name,descr,floor,prom_src,sign \
;        from f_act_data('SCR','ics010101','list0',array['@@@cid@@@','@@@CITY@@@','@@@sbo@@@'],null::cus_list01)
;list1 hidden field=0
;list1 img field=1,5
;list1 link pic1=,/images/
;list1 link prom_src=,
;list1 row act=scr=ics01010101&ncid=@@@ncid@@@

[ics010102]
nav0 sql=select name from prom_src where key='@@@skey@@@'
init act=A_LISTAPPEND(scr=ics010102&skey=@@@skey@@@&channel=@@@channel@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@,channel)
style=TAB

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=ics010102&sbo=@@@sbo@@@&skey=@@@skey@@@&channel=@@@channel@@@&x=@@x@@&y=@@y@@&_key=@@@_key@@@)
sbo0 act flr=

list0 layout=L55
list0 title=S_ALL 
list0 load=act=load&scr=ics010102&_ns=list0&_key=@@@_key@@@&skey=@@@skey@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@&_key=@@@_key@@@
list0 sql=select cus.nid as ncid,cus.pic2,cus.name,cus.addr, \
        f_distance('POINT(@@@X@@@ @@@Y@@@)','POINT('||x||' '||y||')') as dis, \
        'local.bank;'||cus.prom_src as prom_src,cus.seq,cus.sign,'' as fld \
        from cus \
        where cus.prom_src ilike '%@@@skey@@@%' \
	and (case when '@@@_key@@@' = '' or '@@@_key@@@' = 'S_ALL' then true \
	else cus.channel='@@@_key@@@' end) \
        and cus.area='@@@CITY@@@' \
        and cus.store_flag='1' \
        and cus.stat='t' \
	and (case when '@@@sbo@@@' <> '' \
                then cus.name  ilike '%@@@sbo@@@%'  \
		or cus.addr ilike '%@@@sbo@@@%' \
                else true end) \
        group by cus.nid,cus.pic1,cus.name,cus.addr,dis \
        order by cus.seq nulls last,dis asc nulls last,cus.nid desc
list0 hidden field=0,6,8
list0 img field=1,5
list0 link pic2=,/images/
list0 link prom_src=,
list0 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
	'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list0 row act=@@@fld@@@ 

[ics010103]
nav0 sql=select name from cus where nid='@@@cid@@@'
init act=A_LISTAPPEND(scr=ics010103&cid=@@@cid@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@,floor)
style=TAB

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=ics010103&sbo=@@@sbo@@@&cid=@@@cid@@@&x=@@x@@&y=@@y@@)
sbo0 act flr=

list0 layout=L65
list0 title=S_ALL
list0 load=act=load&scr=ics010103&_ns=list0&cid=@@@cid@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@&_key=@@@_key@@@
list0 sql=select * from \
        (select distinct cus.nid as ncid,cus.pic2,cus.name,cus.info, \
        (case when '@@@_key@@@' = '' or '@@@_key@@@'='S_ALL' then cus.floor||'F' \
        else '' end) as dis,\
        cus.seq,cus.sign,cus.floor,'' as fld \
        from cus \
        where cus.pnid='@@@cid@@@' \
        and cus.area='@@@CITY@@@' \
        and (case when '@@@sbo@@@' <> '' then cus.name ilike '%@@@sbo@@@%' \
        or cus.addr ilike '%@@@sbo@@@%' else true end) \
        and cus.store_flag='1' \
        and cus.stat='t' \
        and (case when '@@@_key@@@'='' or '@@@_key@@@'='S_ALL' then true else \
        cus.floor=cast_str_to_int('@@@_key@@@') end)) as foo\
        order by case when dis ~* '^\d+$' then dis::integer else floor end nulls last, \
        seq nulls last,ncid
list0 hidden field=0,5,7,8
list0 img field=1
list0 link pic2=,/images/
list0 link prom_src=,
list0 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
	'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list0 row act=@@@fld@@@ 

;商家详细页面
[ics01010101]
style=G
nav0 sql=select name from cus where nid='@@@ncid@@@'

list0 layout=L56
list0 sql=select ncid,pic1,uname,nuid,coin,tel,addr,btn1,btn2,btn3,btn1act,btn1rv,btn2rv,rname,sign,x,y\
	 from f_data('ics01010101'::varchar,array['@@@NUID@@@','@@@ncid@@@'],null::cus_det01) 
list0 hidden field=0,10,11,12,14
list0 img field=1,7,8,9
list0 link pic1=,/images/
list0 link btn1=,
list0 link btn2=,
list0 link btn3=,
list0 value btn1='I_LIKE_ON1' if (btn1rv eq '1');\
		'I_LIKE_OFF1' if (1)
list0 value btn2='I_CLLCT_ON1' if (btn2rv eq '1');\
		'I_CLLCT_OFF1' if (1)
list0 value btn3='I_HSTRY' 
list0 value btn1act='A_SUBMIT(scr=like01&ncid=@@@ncid@@@)' if (btn1rv eq '0');\
                'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 act tel=callto://@@@tel@@@
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=cllct01&ncid=@@@ncid@@@)
list0 act btn3=scr=ics01010102&ncid=@@@ncid@@@

list1 layout=L57
list1 style=H2
list1 sql=select prom.nid as npid,prom.pic1, \
	(case prom.type when 'CHKIN' then 'S_WLCM' \
	when 'ADVERT' then 'S_ADVERT'  \
	when 'ADVT1' then 'S_ADVT1' \
	when 'PROM' then 'S_CNSM' else \
	'S_'||prom.type end) as ptype,prom.name,prom.type,'' as action \
	from cus,cus2prom,prom \
	where cus.nid=cus2prom.ncid \
	and cus2prom.prom_nid=prom.nid \  
	and cus.nid='@@@ncid@@@' \
	and (now() between begin_at and prom.end_at) \
	and prom.stat in ('t','ENABLE') \
	order by prom.prior nulls last,prom.name nulls last,prom.end_at,prom.nid
list1 hidden field=0,4,5
list1 img field=1
list1 link pic1=,/images/
list1 value action='scr=ics01010103&npid=@@@npid@@@' if ('@@@type@@@' eq 'ADVT'); \
	'scr=ics01010103&npid=@@@npid@@@' if ('@@@type@@@' eq 'ADVERT'); \
	'scr=ics01010108&npid=@@@npid@@@' if ('@@@type@@@' eq 'ADVT1'); \
	'scr=ics01010105&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'WLCM'); \
	'scr=ics01010105&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'CHKIN'); \
	'scr=ics01010104&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'CNSM'); \
	'scr=ics01010104&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'PROM'); \
	'scr=ics01010106&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'LUCK'); \
	'scr=ics01010109&ncid=@@@ncid@@@&npid=@@@npid@@@' if ('@@@type@@@' eq 'LUCK1'); \
	'scr=ics01010113&ncid=@@@ncid@@@&npid=@@@npid@@@' if ('@@@type@@@' eq 'TICKET'); \
	'' if (1)
list1 row act=@@@action@@@
;stui5.1FUN活动页面
[ics0106]
style=G
nav0 sql=select 'FUN 活動' as name
list0 layout=L69
list0 sql=select cus.pic1,usr.alias,usr.nid,usr.coin \
        from cus,usr \
        where cus.nid='CUSTW00060B0' \
        and usr.nid='@@@NUID@@@'
list0 img field=0
list0 link pic1=,/images/

list1 layout=L57
list1 style=H2
list1 load=act=load&scr=icsfun&_ns=list1
list1 sql=select distinct on(prom.nid) prom.nid as npid,prom.pic1, \
        (case prom.type when 'CHKIN' then 'S_WLCM' \
        when 'ADVERT' then 'S_ADVERT'  \
        when 'ADVT1' then 'S_ADVT1' \
        when 'PROM' then 'S_CNSM' else 'S_'||prom.type end) as ptype,\
        prom.name,prom.type,'' as action,cus.nid as ncid \
        from prom,cus,cus2prom \
        where cus.nid=cus2prom.ncid \
        and cus2prom.prom_nid=prom.nid \
        and (now() between prom.begin_at and prom.end_at) \
        and prom.stat in ('t','ENABLE') \
        and cus.area='@@@CITY@@@' \
        and prom.fun_show=true \
        order by prom.nid,prom.prior nulls last,prom.name nulls last,cus.nid
list1 hidden field=0,4,5,6
list1 img field=1
list1 link pic1=,/images/
list1 value action='scr=ics01010103&npid=@@@npid@@@' if ('@@@type@@@' eq 'ADVT'); \
        'scr=ics01010103&npid=@@@npid@@@' if ('@@@type@@@' eq 'ADVERT'); \
        'scr=ics01010108&npid=@@@npid@@@' if ('@@@type@@@' eq 'ADVT1'); \
        'scr=ics01010105&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'WLCM'); \
        'scr=ics01010105&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'CHKIN'); \
        'scr=ics01010104&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'CNSM'); \
        'scr=ics01010104&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'PROM'); \
        'scr=ics01010106&npid=@@@npid@@@&ncid=@@@ncid@@@' if ('@@@type@@@' eq 'LUCK'); \
        'scr=ics01010109&ncid=@@@ncid@@@&npid=@@@npid@@@' if ('@@@type@@@' eq 'LUCK1'); \
	'scr=ics01010109&ncid=@@@ncid@@@&npid=@@@npid@@@' if ('@@@type@@@' eq 'TICKET'); \
        '' if (1)
list1 row act=@@@action@@@

;stui5.2FUN活动页面
[ics0107]
style=G
nav0 sql=select val from lang where fld='st.kwrd' and key='S_FUN' and locale='zh_TW'

list0 layout=L74
list0 load=act=load&scr=ics0107&_ns=list0
list0 sql=select distinct on (prom.nid) prom.nid as npid,prom.pic1,prom.name,prom.descr,\
        (case prom.type when 'PROM' then 'CNSM' \
                when 'CHKIN' then 'WLCM' \
                else prom.type end) as ptype, \
        (case prom.type when 'CHKIN' then 'S_WLCM' \
                when 'ADVERT' then 'S_ADVERT'  \
                when 'ADVT1' then 'S_ADVT1' \
                when 'PROM' then 'S_CNSM' else \
                'S_'||prom.type end) as stype, \
        '' as fld,cus.nid as ncid \
        from cus,cus2prom,prom \
        where cus.nid=cus2prom.ncid \
        and cus2prom.prom_nid=prom.nid \
        and cus.area='@@@CITY@@@' \
	and prom.fun_show=true \
        and (now() between prom.begin_at and prom.end_at) \
        and prom.stat in ('t','ENABLE') \
        order by prom.nid,prom.prior nulls last,prom.name nulls last,cus.nid
list0 hidden field=0,4,6,7
list0 img field=1
list0 link pic1=,/images/
list0 value fld='scr=ics01010110&ncid=@@@ncid@@@&npid=@@@npid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'TICKET');\
        'scr=ics01010116&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'CNSM');\
        'scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'ADVT');\
        'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if (1)
list0 row act=@@@fld@@@
;大陆活动推荐
[ics0108]
style=G
nav0 sql=select val from lang where fld='st.kwrd' and key='S_FUN' and locale='zh_CN'

list0 layout=L74
list0 load=act=load&scr=ics0108&_ns=list0
list0 sql=select distinct on (prom.nid) prom.nid as npid,prom.pic1,prom.name,prom.descr,\
        (case prom.type when 'PROM' then 'CNSM' \
                when 'CHKIN' then 'WLCM' \
                else prom.type end) as ptype, \
        (case prom.type when 'CHKIN' then 'S_WLCM' \
                when 'ADVERT' then 'S_ADVERT'  \
                when 'ADVT1' then 'S_ADVT1' \
                when 'PROM' then 'S_CNSM' else \
                'S_'||prom.type end) as stype, \
        '' as fld,cus.nid as ncid \
        from cus,cus2prom,prom \
        where cus.nid=cus2prom.ncid \
        and cus2prom.prom_nid=prom.nid \
        and cus.area='@@@CITY@@@' \
        and prom.fun_show=true \
        and (now() between prom.begin_at and prom.end_at) \
        and prom.stat in ('t','ENABLE') \
        order by prom.nid,prom.prior nulls last,prom.name nulls last,cus.nid
list0 hidden field=0,4,6,7
list0 img field=1
list0 link pic1=,/images/
list0 value fld='scr=ics01010113&ncid=@@@ncid@@@&npid=@@@npid@@@' if ('@@@ptype@@@' eq 'TICKET');\
        'scr=ics01010116&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'CNSM');\
        'scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'ADVT');\
        'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if (1)
list0 row act=@@@fld@@@


[like01]
post sql=select f_cus_like_n('@@@NUID@@@','@@@ncid@@@') as g_rv
init act=A_GET(scr=ics01010101&ncid=@@@ncid@@@)

[like02]
post sql=select f_cus_like_n('@@@NUID@@@','@@@ncid@@@') as g_rv
init act=A_GET(scr=ics01010111&ncid=@@@ncid@@@)

[cllct01]
err=@@@p_rv@@@
post sql=select (case f_cus_cllct_n when 0 then '01111' \
	when 1 then '00112' \
	when 2 then '00113' end) as p_rv ,\
	f_cus_cllct_n as g_rv from f_cus_cllct_n('@@@NUID@@@','@@@ncid@@@') 
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok \
	from lang where lang.fld='st.msg' \
	and lang.key='lite010403.msg' \
	and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok \
	from lang where lang.fld='st.msg' \
	and lang.key='lite010403.msg1' \
	and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=ics01010101&ncid=@@@ncid@@@)
;A_HOMEGET(1) A_HOMEGET may change to update

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok \
	from lang where lang.fld='st.msg' \
	and lang.key='lite010403.msg2' \
	and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=ics01010101&ncid=@@@ncid@@@)
[cllct02]
err=@@@p_rv@@@
post sql=select (case f_cus_cllct_n when 0 then '01111' \
	when 1 then '00112' \
	when 2 then '00113' end) as p_rv ,\
	f_cus_cllct_n as g_rv from f_cus_cllct_n('@@@NUID@@@','@@@ncid@@@') 
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=P01
pop0 sql=select 'S_HINT' as error,val,'S_OK' as s_ok \
	from lang where lang.fld='st.msg' \
	and lang.key='lite010403.msg' \
	and lang.locale='@@@LANG@@@'
pop0 btn field=2
pop0 act 2=A_CANCEL

pop1 layout=P01
pop1 sql=select 'S_HINT' as succ,val,'S_OK' as s_ok \
	from lang where lang.fld='st.msg' \
	and lang.key='lite010403.msg1' \
	and lang.locale='@@@LANG@@@'
pop1 btn field=2
pop1 act 2=A_GET(scr=ics01010111&ncid=@@@ncid@@@)
;A_HOMEGET(1) A_HOMEGET may change to update

pop2 layout=P01
pop2 sql=select 'S_HINT' as error,val,'S_OK' as s_ok \
	from lang where lang.fld='st.msg' \
	and lang.key='lite010403.msg2' \
	and lang.locale='@@@LANG@@@'
pop2 btn field=2
pop2 act 2=A_GET(scr=ics01010111&ncid=@@@ncid@@@)

;A_HOMEGET(1)
[ics01010102]
init act=A_POPUP(0)

pop0 layout=L64
pop0 title=S_CUS_HST
pop0 sql=select content,created_at \
	from f_msg_center('@@@ncid@@@',null,'CUSMSG')

[ics01010103]
init act=A_POPUP(0)

pop0 layout=L70
pop0 sql=select pay_coin,type,'' as btn1,to_char(t_use,'YYYY-MM-DD') as begin_at,\
	to_char(t_use_end,'YYYY-MM-DD') as end_at, \
	(select val from lang where key='ics01010103.msg0' and locale='@@@LANG@@@') as title,\
	prom.descr as desc1, \
	(select val from lang where key='ics01010105.msg2' and locale='@@@LANG@@@') as desc2 \
	from prom  \
	where nid='@@@npid@@@'
pop0 hidden field=0,1,2,3,4
pop0 btn field=2
pop0 value btn1='S_OK'
pop0 act btn1=A_CANNEL

[ics01010104]
init act=A_POPUP(0)

pop0 layout=L61
pop0 sql=select \   
	(select val from lang where locale='@@@LANG@@@' and key='ics01010104.msg0') as title,\
	prom.descr as desc1,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg2') as desc2,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010104.msg2') as desc3,\
	prom.descr as desc4,usr.alias,usr.nid,\
	prom.pic2 as img0,\
	(case chkin_type when 'QRCODE' then 'I_QR' else 'I_WKIN' end) as img1,\
	'I_SUCC' as img2,'I_FAIL' as img3,\
	'' as btn0,'' as btn1,'' as btn2,'' as btn3,'' as btn4,\
	to_char(t_use,'YYYY-MM-DD') as begin_at,to_char(t_use_end,'YYYY-MM-DD') as end_at,\
	(f_business('@@@NUID@@@',prom.nid,'@@@ncid@@@',prom.type,'@@@LANG@@@',1,null)).p_rv as g_rv, \
	(select val from lang where locale='@@@LANG@@@'  \       
	and key=(f_business('@@@NUID@@@',prom.nid,'@@@ncid@@@',prom.type,'@@@LANG@@@',1,null)).p_rv) as err,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg3') as desc4,\
	 (select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg4') as desc5,\
	(select val from lang where locale='@@@LANG@@@' and key='S_SHARE_PRIZE') as share1,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010104.msg3') as desc6,\
	cus.ratio,prom.name as name, \
	(select val from lang where locale='@@@LANG@@@' and key='S_SHARE_CNSM') as share2, \
	prom.type,'' as fld,prom.chkin_type  \
	from prom,usr,cus,cus2prom \
        where prom.nid='@@@npid@@@' \
	and usr.nid='@@@NUID@@@' \
	and cus.nid=cus2prom.ncid \
	and cus2prom.prom_nid=prom.nid \
	and cus.nid='@@@ncid@@@'
pop0 hidden field=16,17,18,19,20,21,22,23,25,27,28,29
pop0 btn field=11,12,13,14,15
pop0 img field=7,8,9,10
pop0 value btn0='S_SIGN_IN' if ('@@@g_rv@@@' eq '00106');\
		'@@@err@@@' if (1)
pop0 value btn1='@@@desc6@@@'
pop0 value btn2='@@@desc4@@@'
pop0 value btn3='@@@share1@@@'
pop0 value btn4='@@@desc5@@@'
pop0 value fld='A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&prize=@@prize@@&type=@@@type@@@&seq=2)' if ('@@@g_rv@@@@@@chkin_type@@@' eq '00106WKIN'); \
	'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&prize=@@prize@@&seq=2&sig=@@A_CODESCAN@@&act=set' if ('@@@g_rv@@@@@@chkin_type@@@' eq '00106QRCODE'); \
	'' if (1)
pop0 act btn0=@@@fld@@@
pop0 act btn1=
pop0 act btn2=A_CANCEL
pop0 act btn3=A_SHARE
pop0 act btn4=@@@fld@@@
pop0 link img0=,/images/
pop0 link img1=,
pop0 link img2=,
pop0 link img3=,

[ics01010105]
init act=A_POPUP(0)

pop0 layout=L58
pop0 sql=select prom.pay_coin, \ 
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg0') as title,\
	prom.descr as desc1,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg2') as desc2,\
	(select val from lang where locale='@@@LANG@@@' and key='S_SHARE_WLCM') as share2,\
	(case chkin_type when 'QRCODE' then 'I_QR' else 'I_WKIN' end) as img0,\
	'I_SUCC' as img1,'I_FAIL' as img2,\
	'' as btn0,'' as btn1,'' as btn2,''as btn3,\
	prom.name,prom.type,\
	(f_business('@@@NUID@@@',prom.nid,'@@@ncid@@@',prom.type,'@@@LANG@@@',1,null)).p_rv as g_rv,\
	(select val from lang where locale='@@@LANG@@@' \
        and key=(f_business('@@@NUID@@@',prom.nid,'@@@ncid@@@',prom.type,'@@@LANG@@@',1,null)).p_rv) \
        as err,\
	(select val from lang where locale='@@@LANG@@@' and key='S_SHARE_PRIZE') as share1, \
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg3')  as desc3,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg4') as desc4, \
	to_char(t_use,'YYYY-MM-DD') as begin_at,to_char(t_use_end,'YYYY-MM-DD') as end_at,'' as fld,prom.chkin_type  \
	from usr,prom \
	where prom.nid='@@@npid@@@' \
	and usr.nid='@@@NUID@@@'
pop0 hidden field=12,13,14,15,16,17,18,19,20,21
pop0 btn field=8,9,10,11
pop0 img field=5,6,7
pop0 value btn0='S_SIGN_IN' if ('@@@g_rv@@@' eq '00106');\
		'@@@err@@@' if (1);
pop0 value btn1='@@@desc3@@@'
pop0 value btn2='@@@share1@@@'
pop0 value btn3='@@@desc4@@@'
pop0 value fld='A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2)' if ('@@@g_rv@@@@@@chkin_type@@@' eq '00106WKIN');\
	'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2&sig=@@A_CODESCAN@@&act=set' if ('@@@g_rv@@@@@@chkin_type@@@' eq '00106QRCODE');\
	'' if (1);
pop0 act btn0=@@@fld@@@
pop0 act btn1=A_CANCEL
pop0 act btn2=A_SHARE
pop0 act btn3=@@@fld@@@
pop0 link img0=,
pop0 link img1=,
pop0 link img2=,

[ics01010106]
init act=A_POPUP(0)

pop0 layout=L66
pop0 sql=select \       
	(select val from lang where locale='@@@LANG@@@' and key='ics01010106.msg0') as title1,\        
	prom.descr as desc1,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg2') as desc2,\
	'S_SHAKE' as title2,prom.descr as desc3,\
	(case chkin_type when 'QRCODE' then 'I_QR' else 'I_WKIN' end) as img0,\
	'I_SHAKE' as img1,'I_FAIL' as img2,'I_SUCC' as img3,\
	'' as btn0,'' as btn1,'' as btn2,'' as btn3,'' as btn4,\
	(select val from lang where locale='@@@LANG@@@' and key='S_SHARE_PRIZE') as share1,\
	(select val from lang where locale='@@@LANG@@@' and key='S_SHARE_LUCK') as share2,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg3') as desc4,\
	(select val from lang where locale='@@@LANG@@@' and key='ics01010105.msg4') as desc5, \
	to_char(t_use,'YYYY-MM-DD') as begin_at,to_char(t_use_end,'YYYY-MM-DD') as end_at,\
	(f_business('@@@NUID@@@',prom.nid,'@@@ncid@@@',prom.type,'@@@LANG@@@',1,null)).p_rv as g_rv,\
	(select val from lang where locale='@@@LANG@@@' \         
	and key=(f_business('@@@NUID@@@',prom.nid,'@@@ncid@@@',prom.type,'@@@LANG@@@',1,null)).p_rv) as err, \
	prom.name,prom.pay_coin,prom.type,'' as fld,chkin_type \
	from usr,prom \
	where prom.nid='@@@npid@@@'\         
	and usr.nid='@@@NUID@@@'
pop0 hidden field=14,15,16,17,18,19,20,21,22,23,24,25,26
pop0 btn field=9,10,11,12,13
pop0 img field=5,6,7,8
pop0 value btn0='S_SIGN_IN' if ('@@@g_rv@@@' eq '00106');\
                '@@@err@@@' if (1);
pop0 value btn1='S_SHAKE'
pop0 value btn2='@@@desc5@@@'
pop0 value btn3='@@@desc4@@@'
pop0 value btn4='@@@share1@@@'
pop0 value fld='A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2)' if ('@@@g_rv@@@@@@chkin_type@@@' eq '00106WKIN');\
	'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2&sig=@@A_CODESCAN@@&act=set' if ('@@@g_rv@@@@@@chkin_type@@@' eq '00106QRCODE');\
	'' if (1); 
pop0 act btn0=@@@fld@@@
pop0 act btn1=
pop0 act btn2=@@@fld@@@
pop0 act btn3=A_CANCEL
pop0 act btn4=A_SHARE()
pop0 link img0=,
pop0 link img1=,
pop0 link img2=,
pop0 link img3=,

[ics01010107]
err=@@@g_rv@@@
act=@@@p_act@@@
post sql=select p_rv as g_rv,p_act,p_act0,p_act1,p_p1,p_p2,p_p3,perl_encode(p_p4) as p_p4,p_p5,p_msg \
        from f_business('@@@NUID@@@','@@@npid@@@','@@@ncid@@@','@@@type@@@','@@@LANG@@@','@@@seq@@@'::integer,array['@@@sig@@@','@@@prize@@@','@@@tid@@@','@@@X@@@','@@@Y@@@']) 

list0 title=S_MSG
list0 sql=select '@@@p_p3@@@' as btn0,'S_CONFIRM' as btn1,'@@@p_msg@@@' as btn2, \
	'@@@p_p5@@@' as lbl0,'' as fld
list0 hidden field=4
list0 btn field=0,1,2
list0 value fld='A_SHARE1(@@@p_p4@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=2&act=set)' if ('@@@g_rv@@@' eq '00106');\
        'A_SHARE1(@@@p_p4@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=2&act=set)' if ('@@@g_rv@@@' eq '00107');\
	'A_SHARE1(@@@p_p4@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=2&act=set)' if ('@@@g_rv@@@' eq '00108');\
        '' if (1)
list0 act btn0=@@@fld@@@
list0 act btn1=@@@p_act1@@@
list0 act btn2=@@@p_act0@@@

list1 update=usr_hstry
list1 sql=select nid,content,'S_'||type as type,(case type when 'TICKET' then 'f' else stat end ) as stat,'' as fld from hstry where nid='@@@p_p1@@@'
list1 hidden field=0,3,4
list1 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
	'' if (1)
list1 row act=@@@fld@@@
list1 row id=@@@nid@@@
list1 tag type=@@@stat@@@

list2 update=usr
list2 sql=select alias,age,nid,coin,pref_intrst,email,\
	reg_tel,COALESCE(email,'no') as email_st,\
	COALESCE(reg_tel,'no') as tel_st,sex \
	from usr \
	where usr.nid='@@@NUID@@@'
list2 row id=@@@nid@@@

list3 update=inv
list3 order=lbl3 asc,lbl0 desc
list3 sql=select inv_date,invoice_no,invoice.amount as amount,'' as chkbox,'' as btn0,'' as fld,\
	invoice.stat as stat,coalesce(prom.lottery_chkin,'WKIN') as lottery_chkin \
        from invoice left join prom on invoice.ext_nid=prom.nid \
        where (case when '@@@tid@@@' <> '' then invoice.id::varchar='@@@tid@@@' else false end) 
list3 row id=@@@tid@@@
list3 hidden field=5,7
list3 btn field=4
list3 chk field=3
list3 value btn0='S_C0004' if ('@@@stat@@@' eq 'L'); \
        'S_C0005' if ('@@@stat@@@' eq 'A'); \
        'S_C0006' if ('@@@stat@@@' eq 'R'); \
	'S_C0008' if ('@@@stat@@@' eq 'Q'); \
        'S_C0007' if (1)
list3 value fld='A_SHAKE(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=TICKET&seq=3&tid=@@@tid@@@&x=@@x@@&y=@@y@@)' if ('@@@stat@@@' eq 'L'); \
        'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=TICKET&seq=3&act=set&tid=@@@tid@@@&sig=@@A_CODESCAN@@' if ('@@@stat@@@' eq 'A' && '@@@lottery_chkin@@@' eq 'QRCODE'); \
	'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&tid=@@@tid@@@&ncid=@@@ncid@@@&type=TICKET&seq=3)' if ('@@@stat@@@' eq 'A' && '@@@lottery_chkin@@@' eq 'WKIN'); \
        '' if (1)
list3 act btn0=@@@fld@@@
list3 tag chkbox=@@@tid@@@

[ics01010108]
init act=A_POPUP(0)

pop0 layout=P06
pop0 sql=select prom.advert1 as name from prom where prom.nid='@@@npid@@@'
pop0 img field=0
pop0 link name=,/images/
pop0 act name=A_CANCEL

[ics01010109]
init act=A_POPUP(0)

pop0 layout=L71
pop0 sql=select 'S_SHAKE' as title1,prom.name,'S_SUCC' as title2,prom.descr as descr1,\
	(select val from lang where key='ics01010105.msg2' and locale='@@@LANG@@@') as descr2 ,\
	'I_SHAKE' as img0,'I_SUCC' as img1,\
	(select val from lang where key='ics01010105.msg3' and locale='@@@LANG@@@') as btn0, \
	'S_SHARE' as btn1,'S_SHAKE' as btn2,prom.type \
	from prom where prom.nid='@@@npid@@@'
pop0 hidden field=10
pop0 img field=5,6
pop0 btn field=7,8,9
pop0 link img0=,
pop0 link img1=,
pop0 act btn0=A_CANCEL
pop0 act btn1=A_SHARE
pop0 act btn2=A_SHAKE(scr=ics01010107&type=@@@type@@@&ncid=@@@ncid@@@&npid=@@@npid@@@&seq=3)

;演示活动画面接口
[ics01010110]
nav0 sql=select name from prom where nid='@@@npid@@@'

list0 layout=L75
list0 sql=select prom.advert1 as img0,'I_DETAIL' as img1,'I_DATE' as img2,'I_PRIZE' as img3,\
	'I_DESC' as img4,prom.descr,to_char(coalesce(prom.t_use,'0001-01-01'),'YYYY-MM-DD')||\
	'~'||to_char(coalesce(prom.t_use_end,'0001-01-01'),'YYYY-MM-DD') as pdate,prom.prize,\
	prom.use_descr,'S_SHARE' as btn0,'' as btn1,'' as fld,foo.p_msg as btn1val,foo.p_rv as rv,prom.chkin_type,\
	perl_encode(foo.p_p4) as scont \
	from prom,cus, \
	f_business('@@@NUID@@@','@@@npid@@@','@@@ncid@@@','@@@type@@@','@@@LANG@@@',1,array['@@@sig@@@','@@@prize@@@','@@@tid@@@','@@@X@@@','@@@Y@@@']) as foo \
	where prom.nid='@@@npid@@@' \
	and cus.nid='@@@ncid@@@' 
list0 hidden field=11,12,13,14,15
list0 btn field=9,10
list0 img field=0,1,2,3,4
list0 link img0=,/images/
list0 link img1=,
list0 link img2=,
list0 link img3=,
list0 link img4=,
list0 value fld='A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2)' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00106WKINWLCM');\
	'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2&sig=@@A_CODESCAN@@&act=set' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00106QRCODEWLCM');\
	'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2)' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00106WKINLUCK');\
	'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2&sig=@@A_CODESCAN@@&act=set' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00106QRCODELUCK');\
	'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=4&sig=@@A_CODESCAN@@&act=set' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00116QRCODELUCK');\
	'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=4)' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00116WKINLUCK');\
	'A_SHAKE(scr=ics01010107&type=@@@type@@@&ncid=@@@ncid@@@&npid=@@@npid@@@&seq=3)' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00106NOCHECKLUCK');\
	'scr=ics01010107&type=@@@type@@@&ncid=@@@ncid@@@&npid=@@@npid@@@&seq=4&act=set' if ('@@@rv@@@@@@chkin_type@@@@@@type@@@' eq '00116NOCHECKLUCK');\
	'A_BACK' if ('@@@rv@@@@@@type@@@' eq '00106TICKET' && '@@@OS@@@' eq 'ios' && '@@@APPVER@@@' eq  '1.1.5'); \
	'scr=ics01010118&type=@@@type@@@&ncid=@@@ncid@@@&npid=@@@npid@@@' if ('@@@rv@@@@@@type@@@' eq '00106TICKET'); \
	'A_BACK' if (1)
list0 act btn0=A_SHARE1(@@@scont@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=1&act=set)
list0 act btn1=@@@fld@@@
list0 value btn1='@@@btn1val@@@'

;演示商家详情页面
[ics01010111]
style=G
nav0 sql=select name from cus where nid='@@@ncid@@@'

list0 layout=L46
list0 sql=select ncid,pic1,rname,uname,coin,tel,addr,btn1,btn2,btn1act,btn1rv,btn2rv,sign,x,y,cname \
         from f_data('ics01010101'::varchar,array['@@@NUID@@@','@@@ncid@@@'],null::cus_det01)
list0 hidden field=0,9,10,11,15
list0 img field=1,7,8
list0 link pic1=,/images/
list0 link btn1=,
list0 link btn2=,
list0 value btn1='I_LIKE_ON2' if (btn1rv eq '1');\
		'I_LIKE_OFF2' if (1)
list0 value btn2='I_CLLCT_ON2' if (btn2rv eq '1');\
		'I_CLLCT_OFF2' if (1)
list0 value btn1act='A_SUBMIT(scr=like02&ncid=@@@ncid@@@)' if (btn1rv eq '0');\
                'A_ALERT(S_HINT,S_AL_LIKE,S_OK)' if (1)
list0 act tel=callto://@@@tel@@@
list0 act btn1=@@@btn1act@@@
list0 act btn2=A_SUBMIT(scr=cllct02&ncid=@@@ncid@@@)
list0 act addr=A_MAP(@@@x@@@,@@@y@@@,@@@cname@@@)

list1 layout=L74
list1 load=act=load&scr=ics01010111&_ns=list1&ncid=@@@ncid@@@
list1 sql=select prom.nid as npid,prom.pic1,prom.name,prom.descr,\
	(case prom.type when 'PROM' then 'CNSM' \
                when 'CHKIN' then 'WLCM' \
                else prom.type end) as ptype, \
	(case prom.type when 'CHKIN' then 'S_WLCM' \
        	when 'ADVERT' then 'S_ADVERT'  \
        	when 'ADVT1' then 'S_ADVT1' \
       		when 'PROM' then 'S_CNSM' else \
        	'S_'||prom.type end) as stype, \
	'' as fld \
        from cus,cus2prom,prom \
        where cus.nid=cus2prom.ncid \
        and cus2prom.prom_nid=prom.nid \
        and cus.nid='@@@ncid@@@' \
        and (now() between prom.begin_at and prom.end_at) \
        and prom.stat in ('t','ENABLE') \
        order by prom.prior nulls last,prom.name nulls last
list1 hidden field=0,4,6
list1 img field=1
list1 link pic1=,/images/
list1 value fld='scr=ics01010116&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'CNSM');\
	'scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'ADVT');\
	'scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'ADVERT');\
	'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if (1)
list1 row act=@@@fld@@@

;活动中转POPUP页面
[ics01010112]
post sql=select (case when '@@@type@@@'='LUCK' or '@@@type@@@'='LUCK1' then 1 \
	when '@@@type@@@'='CNSM' then 0 else 9 end) as g_rv 
init act=A_POPUP(@@@g_rv@@@)

pop0 layout=L76
pop0 sql=select 'S_INPUT_COIN' as title,'' as amount,'S_CONFIRM' as btn0,'' as fld
pop0 hidden field=3
pop0 txt field=1
pop0 tag amount=NUM,LISTENER:reward
pop0 re amount=^[0-9]?$
pop0 btn field=2
pop0 value fld='scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@&seq=2&sig=@@A_CODESCAN@@&act=set' if ('@@@chkin_type@@@' eq 'QRCODE');\
        'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&prize=@@prize@@&type=@@@type@@@&seq=2)' if ('@@@chkin_type@@@' eq 'WKIN'); \
	'' if (1) 
pop0 act btn0=@@@fld@@@

pop1 layout=L71
pop1 sql=select 'S_SHAKE' as title1,prom.name,'I_SHAKE' as img0,'' as btn0  from prom where nid='@@@npid@@@'
pop1 img field=2
pop1 link img0=,
pop1 btn field=3
pop1 act btn0=A_SHAKE(scr=ics01010107&type=@@@type@@@&ncid=@@@ncid@@@&npid=@@@npid@@@&seq=3)

;发票添加页面
[ics01010113]
nav0 sql=select 'S_ADD_TICKET' as title

list0 layout=L72
list0 sql=select prom.descr,'' as gdate,'' as no,'' as amount,'S_CONFIRM_TICKET' as btn0,'S_SEARCH' as btn1,current_date as now \
	from prom \
	where nid='@@@npid@@@' 
list0 hidden field=6
list0 txt field=1,2,3
list0 tag amount=<=20
list0 tag gdate=@@@now@@@
list0 tag no=<=50
list0 re amount=^\d*$
list0 re gdate=^\d{4}(-)\d{2}\1\d{2}$
list0 re no=^(\d|\w)+$
list0 btn field=4,5
list0 act btn0=A_SUBMIT(scr=ics01010115&ncid=@@@ncid@@@&npid=@@@npid@@@)
list0 act btn1=scr=ics01010114&ncid=@@@ncid@@@&npid=@@@npid@@@

;发票查询
[ics01010114]
post sql=select f_del_ticket('@@@chkbox@@@','@@@chkbox.val@@@') as g_rv
nav0 sql=select 'S_RECORD_TICKET' as title, 'S_EDIT1' as s_edit
nav0 btn field=1
nav0 act 1=A_DEL(scr=ics01010114&ncid=@@@ncid@@@&npid=@@@npid@@@)

list0 load=act=load&scr=ics01010114&_ns=list0&ncid=@@@ncid@@@&npid=@@@npid@@@
list0 layout=L73
list0 sql=select inv_date,invoice_no,amount,id,'' as chkbox \
	from invoice \
	where usr_nid='@@@NUID@@@'
list0 hidden field=3
list0 chk field=4
list0 tag chkbox=@@@id@@@


;发票添加处理接口
[ics01010115]
err=@@@p_rv@@@
post sql=select p_rv,p_hid from f_add_ticket('@@@NUID@@@','@@@ncid@@@','@@@npid@@@','@@@no@@@','@@@amount@@@','@@@gdate@@@','@@@LANG@@@')

list0 update=usr_hstry
list0 sql=select nid,content,'S_'||type as type,(case type when 'TICKET' then 'f' else stat end ) as stat,'' as fld from hstry where nid='@@@p_hid@@@'
list0 hidden field=0,3,4
list0 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
        '' if (1)
list0 row act=@@@fld@@@
list0 row id=@@@nid@@@
list0 tag type=@@@stat@@@

[ics01010116]
nav0 sql=select name from prom where nid='@@@npid@@@'

list0 layout=L78
list0 sql=select prom.advert1 as img0,'I_DATE' as img1,'I_PRIZE' as img2,'I_DESC' as img3, \
	'I_AMOUNT' as img4,prom.descr,to_char(coalesce(prom.t_use,'0001-01-01'),'YYYY-MM-DD')||\
        '~'||to_char(coalesce(prom.t_use_end,'0001-01-01'),'YYYY-MM-DD') as pdate,\
        prom.prize,lang.val,'' as money,'S_SHARE' as btn0,'' as btn1,'' as fld,foo.p_msg as btn1val,\
	foo.p_rv as rv,prom.chkin_type,cus.ratio as cratio,\
        cus.name as name,perl_encode(foo.p_p4) as scont \
        from prom,lang,cus, \
        f_business('@@@NUID@@@','@@@npid@@@','@@@ncid@@@','@@@type@@@','@@@LANG@@@',1,null) as foo \
        where prom.nid='@@@npid@@@' \
        and 'DESC_'||prom.type=lang.key \
        and cus.nid='@@@ncid@@@' \
        and lang.locale='@@@LANG@@@'
list0 hidden field=12,13,14,15,17,18
list0 btn field=10,11
list0 img field=0,1,2,3,4
list0 txt field=9
list0 tag money=LISTENER:reward,NUM
list0 re money=^\d+\.?\d+
list0 link img0=,/images/
list0 link img1=,
list0 link img2=,
list0 link img3=,
list0 link img4=,
list0 value fld='scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&sig=@@A_CODESCAN@@&prize=@@prize@@&type=@@@type@@@&seq=2&act=set' if ('@@@chkin_type@@@@@@rv@@@' eq 'QRCODE00106');\
        'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&prize=@@prize@@&type=@@@type@@@&seq=2)' if ('@@@chkin_type@@@@@@rv@@@' eq 'WKIN00106'); \
        'A_BACK' if (1)
list0 act btn0=A_SHARE1(@@@scont@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=1&act=set)
list0 value btn1='@@@btn1val@@@'
list0 act btn1=@@@fld@@@

[ics01010117]
nav0 sql=select name from prom where prom.nid='@@@npid@@@'
list0 layout=L79
list0 sql=select prom.advert1 as img0,'I_DATE' as img1,prom.descr,\
	to_char(coalesce(prom.t_use,'0001-01-01'),'YYYY-MM-DD')||\
        '~'||to_char(coalesce(prom.t_use_end,'0001-01-01'),'YYYY-MM-DD') as pdate,\
	'S_SHARE' as btn0,perl_encode(prom.descr) as scont \
	from prom \
	where nid='@@@npid@@@'
list0 hidden field=5
list0 img field=0,1
list0 link img0=,/images/
list0 link img1=,
list0 btn field=4
list0 act btn0=A_SHARE1(@@@scont@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=1&act=set)

[ics01010118]
err=@@@g_rv@@@
post sql=select f_del_ticket('@@@chkbox@@@','@@@chkbox.val@@@') as g_rv
nav0 sql=select 'S_RECORD_TICKET' as title, 'S_EDIT1' as s_edit
nav0 btn field=1
nav0 act 1=A_DEL(scr=ics01010118&ncid=@@@ncid@@@)

list0 layout=L80 
list0 sql=select 'S_C0002' as btn0,'S_C0003' as btn1
list0 btn field=0,1
;list0 act btn0=
list0 act btn1=
list0 act btn0=scr=ics01010119&ncid=@@@ncid@@@&npid=@@@npid@@@
;list0 act btn1=A_SHAKE(scr=ics01010121&ncid=@@@ncid@@@&npid=@@@npid@@@&x=@@x@@&y=@@y@@)

list1 layout=L81
list1 update=inv
list1 req=scr=usr_invoice
list1 src=inv
list1 order=lbl3 asc,lbl0 desc

[ics01010119]
nav0 sql=select 'S_ADD_TICKET' as title

list0 layout=L72
list0 sql=select prom.descr,'' as gdate,'' as tno,'' as amount,'S_CONFIRM_TICKET' as btn0,'S_FINISH' as btn1,current_date as now \
        from prom \
        where nid='@@@npid@@@'
list0 hidden field=6
list0 txt field=1,2,3
list0 tag amount=<=20,0000.0
list0 tag gdate=@@@now@@@
list0 tag tno=<=50,HD00000000
list0 re amount=^\d+$
list0 re gdate=^\d{4}(-)\d{2}\1\d{2}
list0 re tno=^(\d|\w)+$
list0 btn field=4,5
list0 act btn0=A_SUBMIT(scr=ics01010120&ncid=@@@ncid@@@&npid=@@@npid@@@)
list0 act btn1=A_SUBMIT(scr=ics01010120&ncid=@@@ncid@@@&npid=@@@npid@@@);A_BACK

[ics01010120]
err=@@@p_rv@@@
post sql=select p_rv,p_hid,p_id from f_add_ticket('@@@NUID@@@','@@@ncid@@@','@@@npid@@@','@@@tno@@@','@@@amount@@@','@@@gdate@@@','@@@LANG@@@')

list0 update=usr_hstry
list0 sql=select nid,content,'S_'||type as type,(case type when 'TICKET' then 'f' else stat end ) as stat,'' as fld from hstry where nid='@@@p_hid@@@'
list0 hidden field=0,3,4
list0 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
        '' if (1)
list0 row act=@@@fld@@@
list0 row id=@@@nid@@@
list0 tag type=@@@stat@@@

list1 update=inv
list1 order=lbl3 asc,lbl0 desc
list1 sql=select '@@@gdate@@@' as gdate,'@@@tno@@@' as tno,'@@@amount@@@' as amount,\
	'' as chkbox,'' as btn0,'' as fld,invoice.stat \
	from invoice \
	where (case when '@@@p_id@@@' <> '' then id::varchar='@@@p_id@@@' else false end) 
list1 row id=@@@p_id@@@
list1 hidden field=5
list1 btn field=4
list1 chk field=3
list1 value btn0='S_C0004'
list1 value fld='A_SHAKE(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=TICKET&seq=2&tid=@@@p_id@@@&x=@@x@@&y=@@y@@)'
list1 act btn0=@@@fld@@@
list1 tag chkbox=@@@p_id@@@

[ics01010121]
err=@@@p_rv@@@
post sql=select p_rv,p_msg,p_id,p_hid from f_ticket_lottery('@@@NUID@@@','@@@ncid@@@','@@@npid@@@','@@@LANG@@@',@@@X@@@,@@@Y@@@)

list0 sql=select '@@@p_msg@@@' as p_msg,'S_SHARE' as btn0,'S_CONFIRM' as btn1, \ 
	perl_encode(f_msg('S_SHARE_LUCK','@@@LANG@@@','@@@NUID@@@','@@@ncid@@@','@@@npid@@@',null)) \	
	as share_msg
list0 hidden field=3
list0 btn field=1,2
list0 act btn0=A_SHARE1(@@@share_msg@@@,scr=share03&ncid=@@@ncid@@@&npid=@@@npid@@@&type=1&act=set)
list0 act btn1=A_CANCEL

list1 update=inv
list1 order=lbl3 asc,lbl0 desc
list1 sql=select inv_date,invoice_no,invoice.amount as amount,'' as chkbox,'' as btn0,'' as fld, \
	invoice.stat as stat,invoice.id as id,coalesce(prom.lottery_chkin,'WKIN') as lottery_chkin \
        from invoice left join prom on invoice.ext_nid=prom.nid \
        where id in (select regexp_split_to_table('@@@p_id@@@',E',')::integer) 
list1 row id=@@@id@@@
list1 hidden field=5,7,8
list1 btn field=4
list1 chk field=3
list1 value btn0='S_C0004' if ('@@@stat@@@' eq 'L'); \
        'S_C0005' if ('@@@stat@@@' eq 'A'); \
        'S_C0006' if ('@@@stat@@@' eq 'R'); \
	'S_C0008' if ('@@@stat@@@' eq 'Q'); \
        'S_C0007' if (1)
list1 value fld='scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=TICKET&seq=3&act=set&tid=@@@id@@@&sig=@@A_CODESCAN@@' if ('@@@stat@@@' eq 'A' && '@@@lottery_chkin@@@' eq 'QRCODE'); \
	'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&tid=@@@id@@@&ncid=@@@ncid@@@&type=TICKET&seq=3)' if ('@@@stat@@@' eq 'A' && '@@@lottery_chkin@@@' eq 'WKIN'); \
        '' if (1)
list1 act btn0=@@@fld@@@
list1 tag chkbox=@@@id@@@

list2 update=usr_hstry
list2 sql=select nid,content,'S_'||type as type,(case type when 'TICKET' then 'f' else stat end ) as stat,'' as fld from hstry \
	where nid in (select regexp_split_to_table('@@@p_hid@@@',E','))
list2 hidden field=0,3,4
list2 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
        '' if (1)
list2 row act=@@@fld@@@
list2 row id=@@@nid@@@
list2 tag type=@@@stat@@@


[share01]
nav0 sql=select 'S_SHARE' as share,'S_SUBMIT' as submit
nav0 btn field=1
nav0 act submit=A_SHARE(@@@content@@@);A_SUBMIT(scr=share02&npid=@@@npid@@@)
list0 layout=L36
list0 sql=with prom as \
	(select prom.name as pname, cus.name as cname \
	from prom,cus,cus2prom \
	where prom.nid=cus2prom.prom_nid \
        and cus2prom.ncid=cus.nid \
	and prom.nid='@@@prom_id@@@'),\
	def as \
	(select '' as lb,'' as txt1,'S_SUBMIT' as btn1,val \
	from lang \
	where lang.key='lite01010106.msg' \
	and lang.locale='@@@LANG@@@'),\
        lang as \
	(select lang.val as action \
	from lang \
	where lang.key='@@@actions@@@' \
	and lang.locale='@@@LANG@@@') \
	select lb,val as content,btn1,pname,cname,action \
	from prom,def,lang
list0 txt field=1
list0 tag 1=SHR,>0,<281
list0 re  1=^.{1,280}$
list0 btn field=2
list0 hidden field=3,4,5
list0 act btn1=A_SHARE(@@@content@@@);A_SUBMIT(scr=share02&npid=@@@npid@@@)

[share02]
err=@@@g_rv@@@
post sql=select f_prom_share_n('@@@NUID@@@','@@@content@@@','@@@npid@@@') as g_rv

;added by wonderful
;upload argu :_order=pay_coin&_seq=asc(desc)
;prod type=REAL;VIRTUAL;CARD2CARD

[share03]
err=@@@g_rv@@@
post sql=select f_share('@@@NUID@@@','@@@ncid@@@','@@@npid@@@','@@@_site@@@','@@@_time@@@'::timestamp,'@@@_content@@@','@@@type@@@') as g_rv

[ics02]
nav0 sql = select 'S_PROD'  as prod

list0 layout=L52
list0 load=act=load&scr=ics02&_ns=list0
list0 sql=select prod.pic1,prod.name,prod.pay_coin,(qty-cur_qty) as curr_qty,\
        f_date_fmt(prod.end_at,'@@@LANG@@@') as times,prod.rich_text,prod.nid,type,'' as act01 \
        from prod,city2prod \
        where prod.nid=city2prod.prod_nid \
        and city2prod.city_code = '@@@CITY@@@' \
        and current_timestamp between begin_at and end_at \
        and prod.stat='ENABLE'
;        order by prior,\
;	(case when ('@@@_order@@@' is  null or '@@@_seq@@@' is null) then \
;	'1' else '@@@_order@@@' '@@@_seq@@@' end)\
;	,prod.name
;       and city2prod.cat_code = '@@@CITY@@@' \
;list0 hidden field=nid,type,act01
list0 hidden field=5,6,7
list0 value act01='scr=ics0201' if (type eq 'REAL');\
                  'scr=ics0202' if (type eq 'VIRTUAL');\
                  'scr=ics0203' if (type eq 'CARD2CARD')
list0 sort=LANG(S_DESC),pay_coin,asc;LANG(S_ASC),pay_coin,desc;LANG(S_NEW),begin_at,desc;
list0 row act=@@@act01@@@&prod_nid=@@@nid@@@
list0 img field=0
list0 link pic1=,/images/
;product REAL detail
;
[ics0201]
nav0 sql = select 'S_DETAIL'  as prod

list0 layout=L50
list0 sql=select prod.pic1,prod.name,prod.pay_coin,(qty-cur_qty) as current_qty,\
        f_date_fmt(prod.end_at,'@@@LANG@@@') as times,'' as coin,prod.rich_text,\
        'S_CONFIRMSUBMIT' as btn0,prod.nid,'' as usrname,'' as phone_num, '' as usr_addr,\
        '' as usr_memo \
        from prod \
        where prod.nid='@@@prod_nid@@@'
list0 btn field=7
;list0 txt field=usrname,phone_num,usr_addr,usr_memo
list0 txt field=9,10,11,12
;list0 hidden field=nid
list0 hidden field=5,8
list0 img field=0
list0 link pic1=,/images/
list0 act btn0=A_SUBMIT(scr=ics020101&prod_nid=@@@prod_nid@@@)

;get REAL producation
[ics020101]
err=@@@p_rv@@@
;mid=@@@p_mid@@@
post sql=select p_rv,p_mid,p_hid \
	from f_prod_get('@@@NUID@@@','@@@prod_nid@@@','@@@usrname@@@','@@@phone_num@@@','@@@usr_addr@@@','@@@usr_memo@@@','@@@LANG@@@') 
;product VIRTUAL detail

list0 update=usr_hstry
list0 sql=select nid,content,'S_'||type as type,stat,'' as fld from hstry where nid='@@@p_hid@@@'
list0 hidden field=0,3,4
list0 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
        '' if (1)
list0 row act=@@@fld@@@
list0 row id=@@@nid@@@
list0 tag type=@@@stat@@@

list1 update=usr
list1 sql=select alias,age,nid,coin,pref_intrst,email,\
        reg_tel,COALESCE(email,'no') as email_st,\
        COALESCE(reg_tel,'no') as tel_st,sex \
        from usr \
        where usr.nid='@@@NUID@@@'
list1 row id=@@@nid@@@

list2 update=usr_msg_center
list2 sql= select id,subject,content from msg where id='@@@p_mid@@@'

[ics0202]
nav0 sql = select 'S_DETAIL'  as prod

list0 layout=L51
list0 sql=select prod.pic1,prod.name,prod.pay_coin,(qty-cur_qty) as current_qty,\
        f_date_fmt(prod.end_at,'@@@LANG@@@') as times,prod.rich_text,'' as coin,\
        'S_CONFIRMSUBMIT' as btn0,prod.nid,'' as usrname,'' as phone_num,'' as usr_addr, \
	'' as usr_memo \
        from prod \
        where prod.nid='@@@prod_nid@@@'
list0 btn field=7
list0 img field=0
list0 link pic1=,/images/
;list0 txt field=usrname,phone_num,usr_memo
list0 txt field=9,10,11,12
;list0 hidden field=nid
list0 hidden field=5,8
list0 act btn0=A_SUBMIT(scr=ics020201&prod_nid=@@@prod_nid@@@)

[ics020201]
err=@@@p_rv@@@
;mid=@@@p_mid@@@
post sql=select p_rv,p_mid,p_hid \
        from f_prod_get('@@@NUID@@@','@@@prod_nid@@@','@@@usrname@@@','@@@phone_num@@@','@@@usr_addr@@@','@@@usr_memo@@@','@@@LANG@@@')
;product VIRTUAL detail
list0 update=usr_hstry
list0 sql=select nid,content,'S_'||type as type,stat,'' as fld from hstry where nid='@@@p_hid@@@'
list0 hidden field=0,3,4
list0 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
        '' if (1)
list0 row act=@@@fld@@@
list0 row id=@@@nid@@@
list0 tag type=@@@stat@@@

list1 update=usr
list1 sql=select alias,age,nid,coin,pref_intrst,email,\
        reg_tel,COALESCE(email,'no') as email_st,\
        COALESCE(reg_tel,'no') as tel_st,sex \
        from usr \
        where usr.nid='@@@NUID@@@'
list1 row id=@@@nid@@@

list2 update=usr_msg_center
list2 sql= select id,subject,content from msg where id='@@@p_mid@@@'

[ics0203]
nav0 sql = select 'S_DETAIL'  as prod

list0 layout=L50
list0 sql=select prod.pic1,prod.name,prod.pay_coin,(qty-cur_qty) as current_qty,\
        f_date_fmt(prod.end_at,'@@@LANG@@@') as times,'' as coin,prod.rich_text,\
        'S_CONFIRMSUBMIT' as btn0,prod.nid,'' as usrname,'' as phone_num,'' as usr_addr,\
        '' as usr_memo \
        from prod \
        where prod.nid='@@@prod_nid@@@'
list0 btn field=7

;list0 txt field=usrname,phone_num,usr_memo,usr_card
list0 txt field=9,10,11,12
;list0 hidden field=nid
list0 hidden field=5,8
list0 img field=0
list0 link pic1=,/images/
list0 act btn0=A_SUBMIT(scr=ics020301&prod_nid=@@@prod_nid@@@)

[ics020301]
err=@@@p_rv@@@
post sql=select p_rv,p_mid,p_hid \
        from f_prod_get('@@@NUID@@@','@@@prod_nid@@@','@@@usrname@@@','@@@phone_num@@@','@@@usr_addr@@@','@@@usr_memo@@@','@@@LANG@@@')

list0 update=usr_hstry
list0 sql=select nid,content,'S_'||type as type,stat,'' as fld from hstry where nid='@@@p_hid@@@'
list0 hidden field=0,3,4
list0 value fld='scr=prom_back01&_id=@@@nid@@@' if ('@@@type@@@' eq 'S_CNSM');\
        '' if (1)
list0 row act=@@@fld@@@
list0 row id=@@@nid@@@
list0 tag type=@@@stat@@@

list1 update=usr
list1 sql=select alias,age,nid,coin,pref_intrst,email,\
        reg_tel,COALESCE(email,'no') as email_st,\
        COALESCE(reg_tel,'no') as tel_st,sex \
        from usr \
        where usr.nid='@@@NUID@@@'
list1 row id=@@@nid@@@

list2 update=usr_msg_center
list2 sql= select id,subject,content from msg where id='@@@p_mid@@@'

[ics03]
init style=TAB
local,req,del
local=ics03
req=scr=ics03
del=scr=ics0301

post sql=select f_cus_cllct_del_n('@@@chkbox@@@','@@@chkbox.val@@@') as g_rv
nav0 sql=select 'S_CLLCT' as cllct,'S_EDIT1' as s_edit
nav0 btn field=1
nav0 act 1=A_DEL(scr=ics03)

list1 load=act=load&scr=ics03&_ns=list0
list1 title=S_FOOD
list1 layout=L55
list1 sql=select cus.pic2,cus.name,cus.addr,'' as dis,usrbag.nid as bagid, \
	cus.nid as ncid,'local.bank;'||cus.prom_src as prom_src,'' as chkbox,'' as fld \
        from usrbag inner join cus on cus.nid=usrbag.ext_nid \
	where usrbag.nuid = '@@@NUID@@@' \
	and usrbag.type='CLLCT' \
	and cus.channel='FOOD' \ 
        order by usrbag.create_date desc
list1 row id=@@@nid@@@
list1 hidden field=4,5,8
list1 chk field=7
list1 tag 7=@@@bagid@@@
list1 img field=0,6
list1 link pic2=,/images/
list1 link prom_src=,
list1 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
        'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list1 row act=@@@fld@@@

list3 load=act=load&scr=ics03&_ns=list1
list3 title=S_MALL
list3 layout=L55
list3 sql=select cus.pic2,cus.name,cus.addr,'' as dis,usrbag.nid as bagid, \
        cus.nid as ncid,'local.bank;'||cus.prom_src as prom_src,'' as chkbox,'' as fld \
        from usrbag inner join cus on cus.nid=usrbag.ext_nid \
        where usrbag.nuid = '@@@NUID@@@' \
	and cus.channel='MALL' \
        and usrbag.type='CLLCT'\
        order by usrbag.create_date desc
list3 row id=@@@nid@@@
list3 hidden field=4,5
list3 chk field=7
list3 tag 7=@@@bagid@@@
list3 img field=0,6
list3 link pic2=,/images/
list3 link prom_src=,
list3 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
        'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list3 row act=@@@fld@@@

list2 load=act=load&scr=ics03&_ns=list2
list2 title=S_RELAX
list2 layout=L55
list2 sql=select cus.pic2,cus.name,cus.addr,'' as dis,usrbag.nid as bagid, \
        cus.nid as ncid,'local.bank;'||cus.prom_src as prom_src,'' as chkbox,'' as fld\
        from usrbag inner join cus on cus.nid=usrbag.ext_nid \
        where usrbag.nuid = '@@@NUID@@@' \
	and cus.channel in ('RELAX','LIFE') \
        and usrbag.type='CLLCT'\
        order by usrbag.create_date desc
list2 row id=@@@nid@@@
list2 hidden field=4,5
list2 chk field=7
list2 tag 7=@@@bagid@@@
list2 img field=0,6
list2 link pic2=,/images/
list2 link prom_src=,
list2 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
        'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list2 row act=@@@fld@@@

list0 load=act=load&scr=ics03&_ns=list3
list0 title=S_FASHION
list0 layout=L55
list0 sql=select cus.pic2,cus.name,cus.addr,'' as dis,usrbag.nid as bagid, \
        cus.nid as ncid,'local.bank;'||cus.prom_src as prom_src,'' as chkbox,'' as fld \
        from usrbag inner join cus on cus.nid=usrbag.ext_nid \
        where usrbag.nuid = '@@@NUID@@@' \
	and cus.channel='FASHION' \
        and usrbag.type='CLLCT'\
        order by usrbag.create_date desc
list0 row id=@@@nid@@@
list0 hidden field=4,5
list0 chk field=7
list0 tag 7=@@@bagid@@@
list0 img field=0,6
list0 link pic2=,/images/
list0 link prom_src=,
list0 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
        'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list0 row act=@@@fld@@@

[ics0301]
err=@@@g_rv@@@
post sql=select f_cus_cllct_del_n('@@@chkbox@@@','@@@chkbox.val@@@') as g_rv

[del_card]
post sql=delete from usr2card where usr_nid='@@@card_no@@@' returning card_no

[usr_invoice]
list0 update=inv
list0 req=usr_invoice
list0 order=lbl3 asc,lbl0 desc
list0 sql=select inv_date,invoice_no,amount,id,'' as chkbox,'' as btn0,'' as fld,\
        stat,ncid,npid as npid,lottery_chkin \
        from f_get_ticket('@@@NUID@@@','@@@tline@@@'::varchar) 
list0 hidden field=3,6,8,9,10
list0 btn field=5
list0 value btn0='S_C0004' if ('@@@stat@@@' eq 'L'); \
        'S_C0005' if ('@@@stat@@@' eq 'A'); \
        'S_C0006' if ('@@@stat@@@' eq 'R'); \
	'S_C0008' if ('@@@stat@@@' eq 'Q'); \
        'S_C0007' if (1)
list0 value fld='A_SHAKE(scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=TICKET&seq=2&tid=@@@id@@@&x=@@x@@&y=@@y@@)' if ('@@@stat@@@' eq 'L'); \
        'scr=ics01010107&npid=@@@npid@@@&ncid=@@@ncid@@@&type=TICKET&seq=3&act=set&tid=@@@id@@@&sig=@@A_CODESCAN@@' if ('@@@stat@@@' eq 'A' && '@@@lottery_chkin@@@' eq 'QRCODE'); \
        'A_WALKIN(scr=ics01010107&npid=@@@npid@@@&tid=@@@id@@@&ncid=@@@ncid@@@&type=TICKET&seq=3)' if ('@@@stat@@@' eq 'A' && '@@@lottery_chkin@@@' eq 'WKIN'); \
        '' if (1)
list0 act btn0=@@@fld@@@
list0 chk field=4
list0 tag chkbox=@@@id@@@
list0 row id=@@@id@@@

[test01]
style=G
post sql=update usr set city='@@@my_city@@@' where usr.nid='@@@NUID@@@'

nav0 sql=select 'I_CLLCT' as cllct,'I_ST' as logo,lang.val as city \
        from usr,lang \
        where usr.nid='@@@NUID@@@' \
        and lang.key=usr.city \
        and lang.locale='@@@LANG@@@'
nav0 img field=1
nav0 btn field=0,2
nav0 link logo=,
nav0 link cllct=,
nav0 val logo=S_IST
nav0 act cllct=scr=ics03
nav0 act city=scr=city02

list0 layout=L53
list0 sql=select pic,title,act,'' as pic_act,scrdef.country as country \
        from scrdef,city \
        where scrdef.country=city.country \
        and (case when '@@@CITY@@@'<>'' then city.code='@@@CITY@@@' else city.code='S_TPE' end) \
        and (case when '@@@OS@@@' = 'ios' and '@@@APPVER@@@'='1.1.2' then \
        scrdef.os='ios' and scrdef.app_ver='1.1.2' else \
        scrdef.os='android' and scrdef.app_ver='1.1.2' end ) \
        and scrdef.prj ~* 'ics' order by scrdef.prior
list0 img field=1
list0 link title=,
list0 hidden field=0,2,3,4
list0 row act=@@@act@@@
list0 row id=@@@title@@@

list1 layout=L25
list1 style=H2
list1 sql=select prom.npid,prom.ncid,prom.photo,prom.type,'' as action,prom.act \
        from f_adv_show_n('@@@NUID@@@','@@@IP@@@',0,3) as prom
list1 img field=2
list1 hidden field=0,1,3,4,5
list1 link photo=,
list1 tag photo=@@@type@@@
list1 value action='scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@' if (type eq 'ADVT');\
        'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'WLCM');\
        'scr=ics01010116&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'CNSM');\
        'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'LUCK');\
        'scr=ics01010113&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@type@@@' if (type eq 'TICKET');\
        '@@@act@@@' if (1)
list1 act photo=@@@action@@@

bar0 sql=select 'I_BAR_ICS_HOME' as home,'I_BAR_ICS_EXCHANGE' as exchange, \
        'I_BAR_ICS_ME' as me,'I_BAR_ICS_MORE' as more
bar0 height=55
bar0 btn field=0,1,2,3
bar0 link home=,
bar0 link exchange=,
bar0 link me=,
bar0 link more=,
bar0 act home=scr=ics03
bar0 act exchange=scr=ics01
bar0 act me=scr=ics05
bar0 act more=scr=ics06

[test0102]
nav0 sql=select 'S_'||'@@@channel@@@'  as channel
init act=A_LISTAPPEND(scr=test0102&channel=@@@channel@@@&x=@@x@@&y=@@y@@&sbo=@@@sbo@@@,bank)
style=TAB

sbo0 sql=select '' as flr,'@@@sbo@@@' as sbo,'' as btn1
sbo0 txt field=1
sbo0 btn field=0,2
sbo0 tag sbo=S_SRH_HINT
sbo0 act btn1=A_GET(scr=test0102&sbo=@@@sbo@@@&_key=@@@_key@@@&channel=@@@channel@@@&x=@@x@@&y=@@y@@)

list0 layout=L55
list0 title=S_ALL
list0 load=act=load&scr=test0102&_ns=list0&_key=@@@_key@@@&sbo=@@@sbo@@@&channel=@@@channel@@@&x=@@x@@&y=@@y@@
list0 sql=select ncid,pic2,name,addr,dis,prom_src,seq,sign,fld,country from  \
	(select cus.nid as ncid,cus.pic2,cus.name,cus.addr,\
        f_distance('POINT(@@@X@@@ @@@Y@@@)','POINT('||cus.x||' '||cus.y||')') as dis, \
        'local.bank;'||cus.prom_src as prom_src,cus.seq as seq,cus.sign,'' as fld,city.country \
        from cus,city \
        where (case when '@@@_key@@@' = '' or '@@@_key@@@' = 'S_ALL' then true \
        else cus.prom_src ilike '%@@@_key@@@%' end) \
        and cus.store_flag='1' \
        and cus.channel_flag='1' \
        and cus.area='@@@CITY@@@' \
	and cus.area=city.code \
        and cus.stat='t' \
        and cus.channel='@@@channel@@@' \
        and (case when '@@@sbo@@@' <> '' \
                then cus.name  ilike '%@@@sbo@@@%'  \
                or cus.addr ilike '%@@@sbo@@@%' \
                else true end) \
        group by cus.nid,cus.pic2,cus.name,cus.addr,dis,city.country)  as yinsong \
        order by (case when country='TW' then dis else seq end) asc nulls last,ncid desc
list0 hidden field=0,6,8,9
list0 img field=1,5
list0 link pic2=,/images/
list0 link prom_src=,
list0 value fld='scr=ics01010101&ncid=@@@ncid@@@' if ('@@@OS@@@@@@APPVER@@@' eq 'ios1.1.2');\
        'scr=ics01010111&ncid=@@@ncid@@@' if (1)
list0 row act=@@@fld@@@
[test0107]
style=G
nav0 sql=select val from lang where fld='st.kwrd' and key='S_FUN' and locale='zh_TW'

list0 layout=L74
list0 load=act=load&scr=test0107&_ns=list0
list0 sql=select npid,pic1,name,descr,ptype,stype,fld,ncid  from  \
	(select distinct on (prom.nid) prom.nid as npid,prom.pic1,prom.name,prom.descr,prom.prior, \
        (case prom.type when 'PROM' then 'CNSM' \
                when 'CHKIN' then 'WLCM' \
                else prom.type end) as ptype, \
        (case prom.type when 'CHKIN' then 'S_WLCM' \
                when 'ADVERT' then 'S_ADVERT'  \
                when 'ADVT1' then 'S_ADVT1' \
                when 'PROM' then 'S_CNSM' else \
                'S_'||prom.type end) as stype, \
        '' as fld,cus.nid as ncid \
        from cus,cus2prom,prom \
        where cus.nid=cus2prom.ncid \
        and cus2prom.prom_nid=prom.nid \
        and cus.area='@@@CITY@@@' \
        and prom.fun_show=true \
        and (now() between prom.begin_at and prom.end_at) \
        and prom.stat in ('t','ENABLE')) as foo \
        order by prior nulls last,npid,name nulls last,ncid
list0 hidden field=0,4,6,7
list0 img field=1
list0 link pic1=,/images/
list0 value fld='scr=ics01010110&ncid=@@@ncid@@@&npid=@@@npid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'TICKET');\
        'scr=ics01010116&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'CNSM');\
        'scr=ics01010117&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if ('@@@ptype@@@' eq 'ADVT');\
        'scr=ics01010110&npid=@@@npid@@@&ncid=@@@ncid@@@&type=@@@ptype@@@' if (1)
list0 row act=@@@fld@@@

[test01010]

style=G
list0 layout=L53
list0 sql=SELECT count(*) + 50  as a \
	FROM hstry WHERE hstry.type='TICKET' \
	AND coalesce(unit_in,'S_NO') <> 'S_TICKET'

[test01011]
style=G
list0 layout=L53 
list0 sql=SELECT usr.alias as a, usr.name  as b \
	FROM hstry, usr  \
	WHERE hstry.mission ilike '20121207160_'  \ 
	AND hstry.nuid = usr.nid  \
	AND hstry.del_flag = 'f'  
list0 lbl field=0,1

